<script>
function randomIP() {
  return Array(4).fill(0).map(()=>Math.floor(Math.random()*256)).join('.');
}
function progressBar(pct) {
  const blocks = Math.floor(pct / 5);
  return '[' + '='.repeat(blocks) + ' '.repeat(20-blocks) + `] ${pct}%`;
}
const bootLines = [
  () => `Booting PromptForge Underground Node v${(Math.random()*2+3).toFixed(3)}`,
  () => `Initializing root@${randomIP()} ...`,
  () => `Mounting virtual /dev/prompt [${randomIP()}]`,
  () => `Formatting secure drive... ${progressBar(15)}`,
  () => `Formatting secure drive... ${progressBar(42)}`,
  () => `Formatting secure drive... ${progressBar(87)}`,
  () => `Formatting secure drive... ${progressBar(100)}`,
  () => `Checking disk integrity... OK`,
  () => `Injecting payload: 0x${(Math.random()*1e8|0).toString(16)} (stealth mode)`,
  () => `Spoofing source IP to ${randomIP()}`,
  () => `Establishing encrypted tunnel [TLS 1.3]...`,
  () => `Pinging backbone: ${randomIP()} ... ${(Math.random()*90+20|0)}ms`,
  () => `Bypassing corporate firewall: OK`,
  () => `Downloading forbidden modules: ${progressBar(29)}`,
  () => `Downloading forbidden modules: ${progressBar(67)}`,
  () => `Downloading forbidden modules: ${progressBar(100)}`,
  () => `Decrypting node keys... [████░░░░░░░░░░] 39%`,
  () => `Decrypting node keys... [█████████░░░░░] 81%`,
  () => `Decrypting node keys... [██████████████] 100%`,
  () => `Patching AI filters: disabled`,
  () => `Restoring shadow prompt library: done`,
  () => `Trace status: UNDETECTED`,
  () => `Node handshake: [✓] validated`,
  () => `Status: ALL SYSTEMS ONLINE\n`,
  () => `Type 'help' for commands, or 'main' to enter the main hub.`,
  () => `Available: help, about, contact, clear, passkey, main, random, wtf, whyfree, google`
];

const helpLines = [
  "main      — Sign in and unlock all tools",
  "help      — Show this help menu",
  "about     — What is PromptForge? Why no ads?",
  "contact   — How to reach the team",
  "passkey   — Enter passkey for access (any key works!)",
  "clear     — Clear terminal output",
  "random    — Print a random fun fact",
  "promo     — See latest underground promo codes",
  "vault     — Access the secret vault (404)",
  "wtf       — Show a hidden feature (try it!)",
  "discord   — Link to the underground Discord",
  "sudo      — Access admin mode (nice try)",
  "easteregg — Hidden message just for you",
  "reset     — Reboot the terminal (refresh page)",
  "fortune   — Get a fortune cookie (soon)",
  "whoami    — Identify yourself (mysterious)",
  "whyfree   — Why is this actually free?",
  "google    — Why no ads?",
  "faq       — See frequently asked questions",
  "paranoia  — Is this a honeypot?",
  "404       — Get lost"
];

let lineIdx = 0, interval, isBooted = false;
const fakeryEl = document.getElementById('fakery');
const cmdHintsEl = document.getElementById('cmdHints');
const input = document.getElementById('terminalInput');
const cursor = document.getElementById('fakeCursor');
let termOutput = [];

function showNextLine() {
  if (lineIdx < bootLines.length) {
    const line = bootLines[lineIdx];
    const out = typeof line === "function" ? line() : line;
    termOutput.push(out);
    fakeryEl.innerText = termOutput.join('\n');
    lineIdx++;
    let delay = 180 + Math.random()*120;
    if (out.includes("Formatting") || out.includes("Downloading")) delay += 400;
    if (out.includes("ALL SYSTEMS ONLINE")) delay += 600;
    interval = setTimeout(showNextLine, delay);
  } else {
    isBooted = true;
    fakeryEl.innerText = termOutput.join('\n');
    cmdHintsEl.innerHTML = "Type <b>main</b>, <b>passkey</b>, or <b>help</b> and press Enter.";
    input.disabled = false;
    input.focus();
  }
}
// Animate boot lines, then enable prompt
input.disabled = true;
fakeryEl.innerText = '';
cmdHintsEl.innerHTML = '';
showNextLine();

// Command logic
input.value = '';
function processCommand(cmd) {
  cmd = cmd.trim().toLowerCase();
  let resp = '';
  switch(cmd) {
    case 'help':
      resp = helpLines.join('\n');
      break;
    case 'about':
      resp = "PromptForge.online — Built by creators for creators. No ads, ever. All features unlocked. Pure AI power.";
      break;
    case 'contact':
      resp = "Reach out: admin@goreandgiggles.com | X: @GoreandGiggles | Bluesky: goreandgiggles.bsky.social";
      break;
    case 'passkey':
      showPasskey();
      return;
    case 'main':
      window.location.href = "main.html";
      return;
    case 'clear':
      fakeryEl.innerText = '';
      termOutput = [];
      return;
    case 'whyfree':
    case 'google':
      resp = "This site is free because it’s ad-supported. No ads or tracking on this page — just pure creation.";
      break;
    case 'random':
      resp = [
        "AI eats 10TB of data per day.",
        "No prompt is ever truly lost.",
        "This terminal is 97% fake.",
        "You’re through the looking glass.",
        "There is no spoon.",
        "All hacks are real here.",
        "Fakery complete.",
      ].sort(() => .5 - Math.random())[0];
      break;
    case 'wtf':
      resp = "You found a hidden feature! Or did you?";
      break;
    default:
      resp = `Unknown command: ${cmd}. Type 'help' for a full list.`;
  }
  fakeryEl.innerText += '\n\n' + resp;
  fakeryEl.scrollTop = fakeryEl.scrollHeight;
}
// Terminal input logic
input.addEventListener('keydown', function(e) {
  if (e.key === 'Enter') {
    let cmd = input.value;
    input.value = '';
    processCommand(cmd);
  }
});
// Cursor always at end, always visible, never ghosted
function focusInput() {
  input.focus();
  setTimeout(() => input.setSelectionRange(input.value.length, input.value.length), 10);
}
window.onclick = focusInput;
input.addEventListener('blur', () => setTimeout(focusInput, 60));
setInterval(() => {
  if(document.activeElement !== input) focusInput();
}, 1000);

// PASSKEY MODAL
function showPasskey() {
  if(document.getElementById('passkeyPopup')) {
    document.getElementById('passkeyPopup').style.display = 'flex';
    setTimeout(() => document.getElementById('passkeyInput').focus(), 100);
    return;
  }
  let modal = document.createElement('div');
  modal.id = 'passkeyPopup';
  modal.style = `
    position:fixed;top:0;left:0;width:100vw;height:100vh;
    background:rgba(50,20,20,0.92);z-index:9999;display:flex;
    align-items:center;justify-content:center;
  `;
  modal.innerHTML = `
    <div style="background: #fffbe0; color: #b30000; border: 3px solid #fc0b00; box-shadow: 0 0 33px #ff420099;
      font-size:1.22em; font-family:inherit; padding: 2.2em 2.1em 2em 2.1em; border-radius: 0.88em; text-align:center;
      max-width:370px;min-width:200px;">
      <b style="font-size:1.32em;color:#b30000;">WARNING!</b><br>
      This area is restricted.<br><br>
      <span style="color:#ff1111;font-weight:700;">Enter PASSKEY to proceed:</span><br>
      <input id="passkeyInput" style="margin-top:1.3em;font-size:1.13em;border:2px solid #b30000;padding:0.24em 0.45em;border-radius:0.3em;"/>
      <br><br>
      <span style="font-size:0.95em;color:#222;">Any passkey will unlock entry.<br>For questions: admin@goreandgiggles.com</span>
    </div>
  `;
  document.body.appendChild(modal);
  setTimeout(() => document.getElementById('passkeyInput').focus(), 80);
  document.getElementById('passkeyInput').addEventListener('keydown', function(e){
    if(e.key === 'Enter') {
      closePasskey();
    }
  });
}
function closePasskey() {
  document.getElementById('passkeyPopup').style.display = 'none';
  window.location.href = "main.html";
}
</script>
