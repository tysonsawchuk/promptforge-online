import React, { useMemo, useState, useRef, useEffect } from "react";
import { motion, AnimatePresence } from "framer-motion";
import {
  Cpu, Brain, Boxes, Film, Image as ImageIcon, Settings,
  Network, ScanFace, Radar, Wand2, Sparkles, Shuffle,
  FolderOpen, Play, Pause, Loader2, Layers,
  GitPullRequest, Command, Library, User, Camera, Activity,
  Notebook, Search, ChevronDown, ChevronRight, Grip, Link2
} from "lucide-react";

/**
 * ArtForge UI Prototype (v1) — slick, stealth, "underground black site" vibe.
 * - Theme variants: Blacksite (emerald), Specter (cyan), Crimson Ops (red)
 * - Panels: Generate, Characters, Pose Lab, Datasets, Training, Models, Video, Queue, Settings
 * - Visual polish: glass cards, neon accents, motion transitions, custom sliders & pills
 * NOTE: This is a styled MOCK UI for layout & UX discussion. No backend calls.
 */

// ---------- Theme system
const THEMES = {
  blacksite: {
    name: "Blacksite",
    accent: "#22c55e", // emerald
    glow: "0 0 40px rgba(34,197,94,.25)",
    ring: "ring-emerald-400/50",
  },
  specter: {
    name: "Specter",
    accent: "#22d3ee", // cyan
    glow: "0 0 40px rgba(34,211,238,.25)",
    ring: "ring-cyan-400/50",
  },
  crimson: {
    name: "Crimson Ops",
    accent: "#ef4444", // red
    glow: "0 0 40px rgba(239,68,68,.25)",
    ring: "ring-red-400/50",
  },
} as const;

type ThemeKey = keyof typeof THEMES;

function useThemeAccent(theme: ThemeKey) {
  return useMemo(() => THEMES[theme].accent, [theme]);
}

// ---------- Generic UI atoms
const Card: React.FC<React.HTMLAttributes<HTMLDivElement>> = ({ className = "", children, ...rest }) => (
  <div
    className={
      "rounded-2xl border border-white/10 bg-white/5 backdrop-blur-sm shadow-[0_0_0_1px_rgba(255,255,255,0.04)] " +
      "hover:shadow-[0_0_0_1px_rgba(255,255,255,0.08)] " + className
    }
    {...rest}
  >
    {children}
  </div>
);

const SectionTitle: React.FC<{ icon?: React.ReactNode; children: React.ReactNode }> = ({ icon, children }) => (
  <div className="flex items-center gap-3 text-sm tracking-wide uppercase text-white/70">
    <div className="w-8 h-[1px] bg-white/20" />
    {icon}
    <span>{children}</span>
    <div className="flex-1 h-[1px] bg-white/20" />
  </div>
);

const Pill: React.FC<{ active?: boolean; onClick?: () => void; children: React.ReactNode }>
= ({ active, onClick, children }) => (
  <button
    onClick={onClick}
    className={
      `px-3 py-1.5 rounded-full text-xs font-medium transition border ` +
      (active
        ? "bg-white/10 border-white/20 text-white"
        : "bg-white/5 border-white/10 text-white/70 hover:text-white hover:bg-white/10")
    }
  >
    {children}
  </button>
);

const Toggle: React.FC<{ checked: boolean; onChange: (v: boolean) => void; accent: string }>
= ({ checked, onChange, accent }) => (
  <button
    onClick={() => onChange(!checked)}
    className={`relative inline-flex h-6 w-11 items-center rounded-full bg-white/10 border border-white/10 transition`}
    style={{ boxShadow: checked ? `inset 0 0 0 1px ${accent}` : undefined }}
    aria-pressed={checked}
  >
    <span
      className={`inline-block h-4 w-4 transform rounded-full bg-white transition ${checked ? "translate-x-6" : "translate-x-1"}`}
      style={{ boxShadow: checked ? `0 0 14px ${accent}` : undefined }}
    />
  </button>
);

const Slider: React.FC<{ value: number; onChange: (v: number) => void; min: number; max: number; step?: number; accent: string }> = ({ value, onChange, min, max, step = 1, accent }) => {
  const pct = ((value - min) / (max - min)) * 100;
  return (
    <div className="w-full select-none">
      <div className="h-2 bg-white/10 rounded-full relative">
        <div className="absolute left-0 top-0 h-2 rounded-full" style={{ width: `${pct}%`, background: accent, boxShadow: `0 0 16px ${accent}` }} />
        <input
          type="range"
          min={min}
          max={max}
          step={step}
          value={value}
          onChange={(e) => onChange(Number(e.target.value))}
          className="w-full h-2 opacity-0 absolute -top-1"
        />
        <div className="absolute" style={{ left: `calc(${pct}% - 8px)`, top: -6 }}>
          <div className="w-4 h-4 rounded-full bg-white shadow" />
        </div>
      </div>
      <div className="mt-1 text-xs text-white/60">{value}</div>
    </div>
  );
};

// ---------- Pose editor (SVG stick figure with draggable joints)
const JOINTS = [
  "head","neck","l_shoulder","r_shoulder","l_elbow","r_elbow","l_hand","r_hand",
  "spine","hip","l_knee","r_knee","l_foot","r_foot"
] as const;

type JointKey = typeof JOINTS[number];

type PoseState = Record<JointKey, { x: number; y: number }>; 

function defaultPose(width: number, height: number): PoseState {
  const cx = width / 2;
  const cy = height / 2;
  return {
    head: { x: cx, y: cy - 120 },
    neck: { x: cx, y: cy - 90 },
    l_shoulder: { x: cx - 25, y: cy - 90 },
    r_shoulder: { x: cx + 25, y: cy - 90 },
    l_elbow: { x: cx - 45, y: cy - 50 },
    r_elbow: { x: cx + 45, y: cy - 50 },
    l_hand: { x: cx - 55, y: cy - 10 },
    r_hand: { x: cx + 55, y: cy - 10 },
    spine: { x: cx, y: cy - 40 },
    hip: { x: cx, y: cy },
    l_knee: { x: cx - 15, y: cy + 40 },
    r_knee: { x: cx + 15, y: cy + 40 },
    l_foot: { x: cx - 10, y: cy + 80 },
    r_foot: { x: cx + 10, y: cy + 80 },
  };
}

const Bone: React.FC<{ a: { x:number;y:number }; b: {x:number;y:number}; accent: string }>=({ a, b, accent }) => (
  <line x1={a.x} y1={a.y} x2={b.x} y2={b.y} stroke={accent} strokeWidth={3} strokeLinecap="round" />
);

const Joint: React.FC<{ p: {x:number;y:number}; onDrag: (dx:number, dy:number) => void; accent: string }> = ({ p, onDrag, accent }) => {
  const ref = useRef<SVGCircleElement | null>(null);
  useEffect(() => {
    const el = ref.current;
    if (!el) return;
    let sx=0, sy=0, down=false;
    const md = (e: MouseEvent) => { down=true; sx=e.clientX; sy=e.clientY; };
    const mm = (e: MouseEvent) => { if(!down) return; onDrag(e.clientX - sx, e.clientY - sy); sx=e.clientX; sy=e.clientY; };
    const mu = () => { down=false; };
    el.addEventListener("mousedown", md);
    window.addEventListener("mousemove", mm);
    window.addEventListener("mouseup", mu);
    return () => { el.removeEventListener("mousedown", md); window.removeEventListener("mousemove", mm); window.removeEventListener("mouseup", mu); };
  }, [onDrag]);
  return <circle ref={ref} cx={p.x} cy={p.y} r={7} fill="white" stroke={accent} strokeWidth={2} />;
};

function PoseEditor({ accent }: { accent: string }) {
  const W=420, H=360;
  const [pose, setPose] = useState<PoseState>(() => defaultPose(W, H));
  const move = (k: JointKey, dx: number, dy: number) => setPose((p) => ({ ...p, [k]: { x: p[k].x + dx, y: p[k].y + dy } }));
  const exportJSON = () => {
    const blob = new Blob([JSON.stringify(pose, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a"); a.href=url; a.download="pose.json"; a.click();
    URL.revokeObjectURL(url);
  };
  return (
    <Card className="p-4">
      <SectionTitle icon={<ScanFace className="w-4 h-4" />}>Pose Lab</SectionTitle>
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
        <div className="flex items-center justify-center">
          <svg width={W} height={H} className="rounded-xl bg-white/5" style={{ boxShadow: `inset 0 0 0 1px rgba(255,255,255,.06)` }}>
            {/* bones */}
            <Bone a={pose.head} b={pose.neck} accent={accent} />
            <Bone a={pose.neck} b={pose.l_shoulder} accent={accent} />
            <Bone a={pose.neck} b={pose.r_shoulder} accent={accent} />
            <Bone a={pose.neck} b={pose.spine} accent={accent} />
            <Bone a={pose.spine} b={pose.hip} accent={accent} />
            <Bone a={pose.l_shoulder} b={pose.l_elbow} accent={accent} />
            <Bone a={pose.r_shoulder} b={pose.r_elbow} accent={accent} />
            <Bone a={pose.l_elbow} b={pose.l_hand} accent={accent} />
            <Bone a={pose.r_elbow} b={pose.r_hand} accent={accent} />
            <Bone a={pose.hip} b={pose.l_knee} accent={accent} />
            <Bone a={pose.hip} b={pose.r_knee} accent={accent} />
            <Bone a={pose.l_knee} b={pose.l_foot} accent={accent} />
            <Bone a={pose.r_knee} b={pose.r_foot} accent={accent} />
            {/* joints */}
            {JOINTS.map((k) => (
              <Joint key={k} p={pose[k]} onDrag={(dx,dy)=>move(k,dx,dy)} accent={accent} />
            ))}
          </svg>
        </div>
        <div className="space-y-4">
          <div className="text-sm text-white/80 leading-relaxed">
            Drag the joints to define a pose. Save as JSON and reuse it across models or characters. This mirrors a ControlNet OpenPose workflow.
          </div>
          <div className="flex gap-3">
            <button
              className="px-4 py-2 rounded-xl bg-white/10 border border-white/10 text-white hover:bg-white/15"
              onClick={()=>setPose(defaultPose(W,H))}
            >Reset</button>
            <button
              className="px-4 py-2 rounded-xl text-black font-semibold"
              style={{ background: accent }}
              onClick={exportJSON}
            >Save Pose JSON</button>
          </div>
          <div className="grid grid-cols-2 gap-3">
            {["T-Pose","Hands-on-Hips","Kneel","Over-Shoulder"].map(p=> (
              <button key={p} className="px-3 py-2 rounded-lg bg-white/5 text-white/80 border border-white/10 hover:bg-white/10">{p}</button>
            ))}
          </div>
          <div className="text-xs text-white/60">Tip: Pair with Depth/Lineart ControlNets for better structural consistency.</div>
        </div>
      </div>
    </Card>
  );
}

// ---------- Character system mock
function Characters({ accent }: { accent: string }) {
  const [cards] = useState([
    { name: "Aurora", base: "RealVisXL V5", loras: ["aurora_face", "cinematic_skin"], last: "Today" },
    { name: "Nyx", base: "DreamShaper XL", loras: ["nyx_alt", "freckles"], last: "2d ago" },
    { name: "Valkyrie", base: "SDXL Base", loras: ["valk_posepack"], last: "5d ago" },
  ]);
  return (
    <Card className="p-4">
      <SectionTitle icon={<User className="w-4 h-4" />}>Characters</SectionTitle>
      <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-4 mt-4">
        {cards.map((c) => (
          <div key={c.name} className="rounded-xl border border-white/10 bg-gradient-to-b from-white/5 to-white/[0.02] p-4">
            <div className="flex items-center justify-between">
              <div className="text-white font-semibold">{c.name}</div>
              <span className="text-xs text-white/60">{c.last}</span>
            </div>
            <div className="mt-3 text-xs text-white/70">Base: <span className="text-white/90">{c.base}</span></div>
            <div className="mt-2 text-xs text-white/70">LoRAs: {c.loras.map(l=> <span key={l} className="inline-block px-2 py-0.5 rounded bg-white/10 border border-white/10 mr-1 text-white/90">{l}</span>)}</div>
            <div className="mt-4 flex gap-2">
              <button className="px-3 py-1.5 rounded-lg text-black font-semibold" style={{ background: accent }}>Set Active</button>
              <button className="px-3 py-1.5 rounded-lg bg-white/10 border border-white/10 text-white">Details</button>
            </div>
          </div>
        ))}
        <div className="rounded-xl border border-dashed border-white/10 p-4 flex items-center justify-center text-white/60 hover:text-white hover:border-white/20 cursor-pointer">
          + Create Character
        </div>
      </div>
    </Card>
  );
}

// ---------- Generate panel mock
function Generate({ accent }: { accent: string }) {
  const [steps, setSteps] = useState(28);
  const [cfg, setCfg] = useState(6.5);
  const [nsfw, setNsfw] = useState(true);
  const [size, setSize] = useState("Portrait 4:5");
  const [sampler, setSampler] = useState("DPM++ 2M");
  const samplers = ["DPM++ 2M","Euler","Euler a","Heun","DDIM"];

  return (
    <Card className="p-4">
      <SectionTitle icon={<Wand2 className="w-4 h-4" />}>Generate</SectionTitle>
      <div className="grid lg:grid-cols-3 gap-6 mt-4">
        <div className="space-y-4 lg:col-span-2">
          <div className="grid md:grid-cols-2 gap-3">
            <textarea placeholder="Prompt" className="min-h-[110px] rounded-xl bg-white/5 border border-white/10 p-3 text-white/90 focus:outline-none focus:ring-2 focus:ring-emerald-400/40" />
            <textarea placeholder="Negative" className="min-h-[110px] rounded-xl bg-white/5 border border-white/10 p-3 text-white/90 focus:outline-none focus:ring-2 focus:ring-emerald-400/40" />
          </div>
          <div className="grid md:grid-cols-3 gap-3">
            <div>
              <div className="text-xs text-white/70 mb-1">Steps</div>
              <Slider value={steps} onChange={setSteps} min={10} max={60} accent={accent} />
            </div>
            <div>
              <div className="text-xs text-white/70 mb-1">CFG</div>
              <Slider value={cfg} onChange={setCfg} min={1} max={12} step={0.5} accent={accent} />
            </div>
            <div>
              <div className="text-xs text-white/70 mb-1">Sampler</div>
              <div className="flex flex-wrap gap-2">
                {samplers.map(s => <Pill key={s} active={sampler===s} onClick={()=>setSampler(s)}>{s}</Pill>)}
              </div>
            </div>
          </div>
          <div className="grid md:grid-cols-3 gap-3 items-center">
            <div className="text-xs text-white/70">Size</div>
            <div className="flex flex-wrap gap-2 md:col-span-2">
              {["Square 1:1","Portrait 4:5","Portrait 2:3","Landscape 3:2","Landscape 16:9"].map(s => (
                <Pill key={s} active={size===s} onClick={()=>setSize(s)}>{s}</Pill>
              ))}
            </div>
          </div>
          <div className="flex items-center gap-3">
            <div className="text-xs text-white/70">NSFW (adult) allowed</div>
            <Toggle checked={nsfw} onChange={setNsfw} accent={accent} />
            <div className="ml-auto flex gap-2">
              <button className="px-4 py-2 rounded-xl bg-white/10 border border-white/10 text-white">Inspire</button>
              <button className="px-4 py-2 rounded-xl text-black font-semibold" style={{ background: accent }}>Generate</button>
            </div>
          </div>
        </div>
        <div className="space-y-4">
          <div className="rounded-xl bg-gradient-to-b from-white/5 to-white/[0.02] border border-white/10 p-4">
            <div className="text-xs text-white/70 mb-2">Model</div>
            <div className="flex items-center gap-2">
              <Layers className="w-4 h-4 text-white/60" />
              <div className="flex-1 text-white">RealVisXL V5</div>
              <ChevronDown className="w-4 h-4 text-white/60" />
            </div>
            <div className="mt-3 text-xs text-white/60">LoRAs</div>
            <div className="mt-1 flex flex-wrap gap-2">
              {["freckles","glam_skin","pose_pack"].map(l => (
                <span key={l} className="px-2 py-1 rounded-lg bg-white/10 border border-white/10 text-white/90 text-xs">{l}</span>
              ))}
              <button className="px-2 py-1 rounded-lg bg-white/5 border border-white/10 text-white/70">+ Add</button>
            </div>
          </div>
          <div className="rounded-xl bg-white/5 border border-white/10 p-4">
            <div className="text-xs text-white/70">GPU/Queue</div>
            <div className="mt-2 h-20 rounded-md bg-black/30 overflow-hidden">
              {/* fake sparkline */}
              <div className="h-full w-full relative">
                <div className="absolute inset-0 opacity-30 bg-[radial-gradient(transparent,transparent,rgba(255,255,255,0.08))]" />
                <div className="absolute bottom-0 left-0 h-8 w-full bg-gradient-to-t from-emerald-500/30 to-transparent" />
              </div>
            </div>
            <div className="mt-2 text-xs text-white/60">Jobs: 2 queued · VRAM 9.8/11 GB</div>
          </div>
        </div>
      </div>
    </Card>
  );
}

// ---------- Datasets/Crawler mock
function Datasets({ accent }: { accent: string }) {
  const [respect, setRespect] = useState(true);
  const [ack, setAck] = useState(false);
  return (
    <Card className="p-4">
      <SectionTitle icon={<Network className="w-4 h-4" />}>Crawler</SectionTitle>
      <div className="grid md:grid-cols-2 gap-6 mt-4">
        <div className="space-y-3">
          <textarea placeholder="Start URLs (one per line)" className="min-h-[120px] rounded-xl bg-white/5 border border-white/10 p-3 text-white/90" />
          <div className="grid grid-cols-2 gap-3">
            <div>
              <div className="text-xs text-white/70 mb-1">Respect robots.txt</div>
              <Toggle checked={respect} onChange={setRespect} accent={accent} />
            </div>
            <div>
              <div className="text-xs text-white/70 mb-1">I have rights to ignore</div>
              <Toggle checked={ack} onChange={setAck} accent={accent} />
            </div>
          </div>
          <div className="grid grid-cols-2 gap-3">
            <input placeholder="Include regex" className="rounded-xl bg-white/5 border border-white/10 p-2 text-white/90" />
            <input placeholder="Exclude regex" className="rounded-xl bg-white/5 border border-white/10 p-2 text-white/90" />
          </div>
          <div className="flex gap-2">
            <button className="px-4 py-2 rounded-xl bg-white/10 border border-white/10 text-white">Dry Run</button>
            <button className="px-4 py-2 rounded-xl text-black font-semibold" style={{ background: accent }}>Start Crawl</button>
          </div>
        </div>
        <div>
          <div className="text-xs text-white/70">Output</div>
          <div className="mt-2 min-h-[160px] rounded-xl bg-black/30 border border-white/10 p-3 text-xs text-white/70">
            log.jsonl …
          </div>
        </div>
      </div>
    </Card>
  );
}

// ---------- Models/Training/Video/Queue mocks (compact)
const SmallPanel: React.FC<{ title: string; icon?: React.ReactNode; children?: React.ReactNode }>=({ title, icon, children }) => (
  <Card className="p-4">
    <SectionTitle icon={icon}>{title}</SectionTitle>
    <div className="mt-4">{children}</div>
  </Card>
);

function Models({ accent }: { accent: string }) {
  return (
    <SmallPanel title="Models" icon={<Layers className="w-4 h-4" />}> 
      <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-3">
        {["SDXL Base 1.0","RealVisXL V5.0","DreamShaper XL","Juggernaut XL v9"].map(m => (
          <div key={m} className="rounded-lg p-3 border border-white/10 bg-white/5 flex items-center justify-between">
            <span className="text-white/90 text-sm">{m}</span>
            <button className="px-3 py-1.5 rounded-lg text-black text-xs font-semibold" style={{ background: accent }}>Use</button>
          </div>
        ))}
      </div>
    </SmallPanel>
  );
}

function Training({ accent }: { accent: string }) {
  const [res, setRes] = useState(1024);
  const [rank, setRank] = useState(16);
  return (
    <SmallPanel title="Training (LoRA)" icon={<Brain className="w-4 h-4" />}> 
      <div className="grid md:grid-cols-3 gap-4">
        <div>
          <div className="text-xs text-white/70 mb-1">Resolution</div>
          <Slider value={res} onChange={setRes} min={768} max={1024} step={64} accent={accent} />
        </div>
        <div>
          <div className="text-xs text-white/70 mb-1">Rank</div>
          <Slider value={rank} onChange={setRank} min={4} max={32} step={2} accent={accent} />
        </div>
        <div className="flex items-end">
          <button className="px-4 py-2 rounded-xl text-black font-semibold w-full" style={{ background: accent }}>Start Training</button>
        </div>
      </div>
      <div className="mt-3 text-xs text-white/60">Datasets → pick folder; Queue runs overnight; Auto-merge LoRA into all bases.</div>
    </SmallPanel>
  );
}

function Video({ accent }: { accent: string }) {
  return (
    <SmallPanel title="Video (SVD img→video)" icon={<Film className="w-4 h-4" />}> 
      <div className="grid md:grid-cols-4 gap-3 items-end">
        <div className="text-xs text-white/70">Frames
          <div className="mt-1" />
          <input type="number" defaultValue={25} className="w-full rounded-xl bg-white/5 border border-white/10 p-2 text-white/90" />
        </div>
        <div className="text-xs text-white/70">FPS
          <div className="mt-1" />
          <input type="number" defaultValue={6} className="w-full rounded-xl bg-white/5 border border-white/10 p-2 text-white/90" />
        </div>
        <div className="text-xs text-white/70">Motion Bucket
          <div className="mt-1" />
          <input type="number" defaultValue={127} className="w-full rounded-xl bg-white/5 border border-white/10 p-2 text-white/90" />
        </div>
        <button className="px-4 py-2 rounded-xl text-black font-semibold" style={{ background: accent }}>Render</button>
      </div>
    </SmallPanel>
  );
}

function QueuePanel() {
  return (
    <SmallPanel title="Queue / GPU" icon={<Activity className="w-4 h-4" />}> 
      <div className="grid md:grid-cols-2 gap-3">
        <div className="rounded-xl bg-black/30 border border-white/10 h-28" />
        <div className="space-y-2 text-xs text-white/70">
          <div>1. t2i — seed 431533 · <span className="text-emerald-400">running</span></div>
          <div>2. svd — keyframe #12 · queued</div>
          <div>3. train — lora glam_skin · queued</div>
        </div>
      </div>
    </SmallPanel>
  );
}

// ---------- Main shell
const NAV = [
  { key: "generate", label: "Generate", icon: Wand2 },
  { key: "characters", label: "Characters", icon: User },
  { key: "pose", label: "Pose Lab", icon: ScanFace },
  { key: "datasets", label: "Datasets", icon: FolderOpen },
  { key: "training", label: "Training", icon: Brain },
  { key: "models", label: "Models", icon: Layers },
  { key: "video", label: "Video", icon: Film },
  { key: "queue", label: "Queue", icon: Activity },
  { key: "settings", label: "Settings", icon: Settings },
] as const;

type NavKey = typeof NAV[number]["key"];

function Sidebar({ current, setCurrent, accent, theme }: { current: NavKey; setCurrent: (k: NavKey)=>void; accent: string; theme: ThemeKey }) {
  return (
    <div className="h-full w-64 p-4 border-r border-white/10 bg-[linear-gradient(180deg,rgba(255,255,255,0.04),rgba(255,255,255,0.02))]">
      <div className="flex items-center gap-2 mb-6">
        <div className="w-2.5 h-6 rounded-full" style={{ background: accent, boxShadow: THEMES[theme].glow }} />
        <div className="text-white font-bold tracking-wide">ArtForge</div>
      </div>
      <div className="space-y-1">
        {NAV.map(({ key, label, icon: Icon }) => (
          <button
            key={key}
            onClick={() => setCurrent(key)}
            className={`w-full flex items-center gap-3 px-3 py-2 rounded-xl text-sm transition border ${
              current===key
                ? "bg-white/10 border-white/20 text-white"
                : "bg-transparent border-white/10 text-white/70 hover:text-white hover:bg-white/5"
            }`}
          >
            <Icon className="w-4 h-4" />
            <span>{label}</span>
          </button>
        ))}
      </div>
      <div className="mt-8 text-xs text-white/40">vPrototype · UI only</div>
    </div>
  );
}

function Header({ theme, setTheme }: { theme: ThemeKey; setTheme: (t: ThemeKey)=>void }) {
  const accent = useThemeAccent(theme);
  return (
    <div className="h-16 px-6 border-b border-white/10 flex items-center justify-between" style={{ background: "rgba(255,255,255,0.03)" }}>
      <div className="text-white/80 text-sm tracking-wide">Blacksite Console</div>
      <div className="flex items-center gap-2">
        {Object.keys(THEMES).map((k) => (
          <button key={k}
            className="px-3 py-1.5 rounded-lg text-xs border border-white/10 text-white/70 hover:text-white"
            style={{ boxShadow: theme===k ? THEMES[k as ThemeKey].glow : undefined }}
            onClick={()=>setTheme(k as ThemeKey)}
          >{THEMES[k as ThemeKey].name}</button>
        ))}
        <div className="ml-3 w-2.5 h-2.5 rounded-full" style={{ background: accent, boxShadow: THEMES[theme].glow }} />
      </div>
    </div>
  );
}

function Page({ theme }: { theme: ThemeKey }) {
  const [tab, setTab] = useState<NavKey>("generate");
  const accent = useThemeAccent(theme);
  return (
    <div className="h-[100vh] w-full text-white" style={{ background: "#0b0a0f" }}>
      {/* subtle grid */}
      <div className="pointer-events-none fixed inset-0 opacity-[.035]" style={{ backgroundImage: "linear-gradient(to right, #fff 1px, transparent 1px), linear-gradient(to bottom, #fff 1px, transparent 1px)", backgroundSize: "28px 28px" }} />
      <div className="relative z-10 h-full grid" style={{ gridTemplateColumns: "16rem 1fr" }}>
        <Sidebar current={tab} setCurrent={setTab} accent={accent} theme={theme} />
        <div className="flex flex-col h-full">
          <Header theme={theme} setTheme={() => {}} />
          <div className="flex-1 overflow-auto p-6 space-y-6">
            {tab === "generate" && <Generate accent={accent} />}
            {tab === "characters" && <Characters accent={accent} />}
            {tab === "pose" && <PoseEditor accent={accent} />}
            {tab === "datasets" && <Datasets accent={accent} />}
            {tab === "training" && <Training accent={accent} />}
            {tab === "models" && <Models accent={accent} />}
            {tab === "video" && <Video accent={accent} />}
            {tab === "queue" && <QueuePanel />}
            {tab === "settings" && (
              <Card className="p-4">
                <SectionTitle icon={<Settings className="w-4 h-4" />}>Settings</SectionTitle>
                <div className="mt-4 text-sm text-white/70">Paths, licenses, and advanced toggles will live here.</div>
              </Card>
            )}
          </div>
        </div>
      </div>
    </div>
  );
}

export default function App() {
  const [theme, setTheme] = useState<ThemeKey>("blacksite");
  return <Page theme={theme} />;
}
