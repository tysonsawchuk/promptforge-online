<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PromptForge &mdash; Image Intelligence Portal (Face Mapping &bull; Scene Captioning &bull; JSON/Embedding Export)</title>
  <meta name="description" content="PromptForge Image Intelligence: client-side face mapping with landmark mesh and TV-style measurements, full-image captioning (Transformers.js), object tags (COCO-SSD), OCR (Tesseract), animated scan overlay, and pro exports for SDXL/Flux/MJ or LoRA/DreamBooth." />
  <link rel="canonical" href="https://promptforge.online/image-intel.html" />
  <meta name="theme-color" content="#08131b" />

  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="PromptForge &mdash; Image Intelligence Portal" />
  <meta property="og:description" content="Analyze &rarr; Measure &rarr; Explain. Live landmark mesh, government-grade ratios, animated scan, and JSON/embedding exports. J1NX assistant built in." />
  <meta property="og:image" content="/assets/og/imagetoprompt.png" />
  <meta property="og:url" content="https://promptforge.online/image-intel.html" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- JSON-LD: Organization + WebSite + Breadcrumbs + FAQ (inline, hidden) -->
  <script type="application/ld+json">{
    "@context":"https://schema.org",
    "@type":"Organization",
    "name":"PromptForge",
    "url":"https://promptforge.online/",
    "logo":"https://promptforge.online/assets/og/home.png",
    "sameAs":["https://x.com/GoreandGiggles","https://bsky.app/profile/goreandgiggles.bsky.social","https://promptforge.online/support.html"]
  }</script>
  <script type="application/ld+json">{
    "@context":"https://schema.org",
    "@type":"WebSite",
    "name":"PromptForge",
    "url":"https://promptforge.online/",
    "potentialAction":{"@type":"SearchAction","target":"https://promptforge.online/?q={search_term_string}","query-input":"required name=search_term_string"}
  }</script>
  <script type="application/ld+json">{
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://promptforge.online/"},
      {"@type":"ListItem","position":2,"name":"Tools","item":"https://promptforge.online/#tools"},
      {"@type":"ListItem","position":3,"name":"Image Intelligence"}
    ]
  }</script>
  <script type="application/ld+json">{
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {"@type":"Question","name":"What is the PromptForge Image Intelligence Portal?","acceptedAnswer":{"@type":"Answer","text":"A client-side lab that converts an image into a pro caption, structured prompt, landmark JSON, numeric facial ratios, and optional embeddings for image models (SDXL, Flux, Midjourney) or local LoRA/DreamBooth."}},
      {"@type":"Question","name":"Does it upload my images?","acceptedAnswer":{"@type":"Answer","text":"No. Analysis runs in your browser by default. You can explicitly export JSON to your device."}},
      {"@type":"Question","name":"How do I get a stylized copy (e.g., 'me as Shrek')?","acceptedAnswer":{"@type":"Answer","text":"Use the face mesh + ratios to build a prompt chunk and paste it into SDXL/Flux/MJ. For highest fidelity likeness, fine-tune locally with your photos and include the exported landmarks/ratios as metadata."}},
      {"@type":"Question","name":"What's in the JSON?","acceptedAnswer":{"@type":"Answer","text":"Prompt chunk, 68-pt normalized landmarks, measurement ratios (jaw/face, eye-sep/eye-width, nose/face), palette, alt text, and an embedding field when enabled."}}
    ]
  }</script>

  <style>
    :root{ --bg:#08131b; --ink:#e8f8ff; --muted:#9cc3d6; --aqua:#64f2e3; --aqua2:#23d7ba; --edge:#1b2a36; --card:#0c1922; --ok:#7ef1a6; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:radial-gradient(1200px 700px at 10% -10%,rgba(100,242,227,.07),transparent 55%),radial-gradient(1000px 600px at 120% -10%,rgba(35,215,186,.06),transparent 55%),var(--bg);color:var(--ink);font:14px/1.6 Inter,system-ui,Segoe UI,Roboto,Arial}
    a{color:var(--aqua)}
    .wrap{max-width:1200px;margin:0 auto;padding:18px}

    .top{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .brand{font-weight:900;font-size:22px;letter-spacing:.4px;color:var(--aqua)}
    .crumbs{color:var(--muted);font-size:12px}
    .tool-links{display:flex;gap:8px;flex-wrap:wrap}
    .pill{border:1px solid var(--edge);border-radius:999px;padding:.25rem .6rem;color:var(--muted);font-size:12px}

    .hero{margin-top:12px;display:grid;gap:12px;grid-template-columns:1.1fr .9fr}
    @media(max-width:900px){.hero{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid var(--edge);border-radius:14px;padding:14px;box-shadow:0 14px 40px rgba(0,0,0,.55)}
    .hero h1{margin:.2rem 0 .4rem}
    .sub{color:var(--muted);font-size:12px}

    .grid{display:grid;gap:16px}
    @media(min-width:1024px){.grid{grid-template-columns:320px 1fr}}
    h3{margin:.2rem 0 .8rem;color:var(--muted);font-size:15px}

    .steps{position:sticky;top:14px;display:flex;flex-direction:column;gap:10px}
    .step{border-left:3px solid #0f2630;padding:10px;border-radius:10px;background:linear-gradient(180deg,rgba(10,26,34,.6),rgba(10,26,34,.3))}
    .step.active{border-left-color:var(--aqua)}
    .step .num{display:inline-block;width:22px;height:22px;border-radius:50%;background:#0f2a33;border:1px solid var(--edge);text-align:center;line-height:22px;margin-right:8px;color:var(--aqua)}

    .choose{display:flex;align-items:center;justify-content:center;gap:10px;padding:12px 14px;border:1.5px solid var(--aqua);border-radius:12px;background:linear-gradient(90deg,#0a2831,#0a2e2b);color:#eafffb;font-weight:800;cursor:pointer;box-shadow:0 0 0 0 rgba(100,242,227,.45);transition:box-shadow .25s}
    .choose:hover{box-shadow:0 0 0 4px rgba(100,242,227,.15),0 0 24px rgba(100,242,227,.25)}
    #file{display:none}

    .btn{background:#0e1f27;border:1px solid var(--edge);color:var(--ink);padding:9px 12px;border-radius:10px;cursor:pointer}
    .btn.primary{border-color:var(--aqua);box-shadow:0 0 0 2px rgba(100,242,227,.12) inset}

    textarea,.outbox{width:100%;min-height:120px;background:#07141c;border:1px solid #0f2833;border-radius:12px;color:var(--ink);padding:10px;box-shadow:0 0 22px rgba(100,242,227,.08)}
    .mono{font-family:ui-monospace,Menlo,Consolas,monospace}

    #previewWrap{position:relative}
    #preview{width:100%;border-radius:10px;background:#061219}
    #overlay{position:absolute;left:0;top:0;width:100%;border-radius:10px;pointer-events:none}
    .legend{position:absolute;right:10px;top:10px;background:#08141caa;border:1px solid #10313b;border-radius:10px;padding:8px 10px;font:12px/1.3 ui-monospace,monospace}

    .modal{position:fixed;inset:0;background:rgba(0,0,0,.65);display:none;align-items:center;justify-content:center;z-index:60}
    .modal.open{display:flex}
    .sheet{background:var(--card);border:1px solid var(--edge);border-radius:14px;max-width:740px;width:92%;padding:16px}

    .ad-wrap{display:block;min-height:90px;border:1px dashed var(--edge);border-radius:12px;margin:8px 0;padding:8px;text-align:center;color:var(--muted)}
    .ad-right{display:flex;gap:8px;align-items:center}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>
        <div class="brand">PromptForge &mdash; Image Intelligence Portal</div>
        <div class="crumbs">Home &rsaquo; Tools &rsaquo; Image Intelligence (Client-Side)</div>
      </div>
      <div class="tool-links">
        <a class="pill" href="/">Home</a>
        <a class="pill" href="/picture.html">Picture Builder</a>
        <a class="pill" href="/movie.html">Movie Builder</a>
        <a class="pill" href="/ansiart.html">ANSI/ASCII Studio</a>
        <a class="pill" href="/compare.html">Model Compare</a>
        <a class="pill" href="/watermark.html">Watermark</a>
        <a class="pill" href="/playground.html">Prompt Patterns</a>
        <a class="pill" href="/about.html">About</a>
        <a class="pill" href="/contact.html">Contact</a>
        <a class="pill" href="/support.html">Support</a>
        <a class="pill" href="/legal.html">Legal</a>
      </div>
    </div>

    <section class="hero">
      <div class="card">
        <h1>Analyze &rarr; Measure &rarr; Explain &rarr; Export</h1>
        <p class="sub">Upload a photo. We run a live 68-pt face mesh with TV-style measures, animate a scan overlay, then generate a professional, human-sounding description of the <em>entire image</em> (caption + objects + OCR cues). Export JSON with normalized landmarks, numeric ratios, palette, and an optional embedding stub for SDXL/Flux/MJ or LoRA/DreamBooth.</p>
      </div>
      <div class="card ad-right">
        <div style="flex:1">
          <h3>Quick links</h3>
          <p class="sub">PromptForge tools &amp; docs.</p>
          <div class="tool-links" style="margin-top:6px">
            <a class="pill" href="/picture.html">Image Prompt Builder</a>
            <a class="pill" href="/movie.html">Video Prompt Builder</a>
            <a class="pill" href="/ansiart.html">ANSI/ASCII Studio</a>
            <a class="pill" href="/watermark.html">Watermark &amp; Privacy</a>
            <a class="pill" href="/playground.html">Prompt Techniques</a>
          </div>
        </div>
        <!-- Your 108x140 Juicy unit -->
        <div style="width:108px;min-width:108px;text-align:center">
          <script type="text/javascript" data-cfasync="false" async src="https://poweredby.jads.co/js/jads.js"></script>
          <ins id="1101940" data-width="108" data-height="140"></ins>
          <script type="text/javascript" data-cfasync="false" async>(adsbyjuicy = window.adsbyjuicy || []).push({"adzone":1101940});</script>
        </div>
      </div>
    </section>

    <main class="grid" style="margin-top:14px">
      <aside class="steps">
        <div class="card step active">
          <div><span class="num">1</span><strong>Choose Image</strong></div>
          <div class="sub">Portrait or scene. Private: runs in your browser.</div>
          <label for="file" class="choose" id="chooseBtn">&#x2795; Choose Image</label>
          <input id="file" type="file" accept="image/*" />
          <div class="ad-wrap">
            <script async src="https://poweredby.jads.co/js/jads.js"></script>
            <ins id="1101674" data-width="auto" data-height="90"></ins>
            <script>try{(adsbyjuicy=window.adsbyjuicy||[]).push({adzone:1101674});}catch(e){}</script>
          </div>
        </div>
        <div class="card step">
          <div><span class="num">2</span><strong>Analyze</strong></div>
          <div class="sub">Enable Full-AI to caption objects &amp; OCR. Face Mode for landmarks + ratios.</div>
          <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
            <button id="analyze" class="btn primary" disabled>Run (Fast)</button>
            <button id="enable-face" class="btn">Face Mode</button>
            <button id="enable-ai" class="btn">Enable Full-AI</button>
          </div>
          <div class="sub" id="progress" style="margin-top:6px">&mdash;</div>
        </div>
        <div class="card step">
          <div><span class="num">3</span><strong>Build &amp; Export</strong></div>
          <div class="sub">Assemble prompt and export JSON/embedding for advanced workflows.</div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="build" class="btn">Build Prompt</button>
            <button id="exportJSON" class="btn">Export JSON</button>
          </div>
        </div>
        <div class="card step">
          <div><span class="num">?</span><strong>Help &amp; FAQ</strong></div>
          <div class="sub">Use prompt directly or fine-tune locally. Privacy details inside.</div>
          <a href="#faq" class="btn">Open FAQ</a>
          <button id="toggleJ1NX" class="btn">Open J1NX</button>
        </div>
      </aside>

      <section class="card">
        <h3>Preview</h3>
        <div id="previewWrap">
          <canvas id="preview" width="900" height="560"></canvas>
          <canvas id="overlay" width="900" height="560"></canvas>
          <div class="legend" id="legend">Ratios: jaw/face, eye-sep/eye-width, nose/face • Units: px &amp; norm</div>
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px">
          <div>
            <h3>Professional Description</h3>
            <textarea id="caption" class="mono" placeholder="&mdash;"></textarea>
          </div>
          <div>
            <h3>Prompt</h3>
            <textarea id="promptOut" class="mono" placeholder="&mdash;"></textarea>
            <div style="display:flex;gap:8px;margin-top:8px"><button id="copyPrompt" class="btn">Copy Prompt</button><button id="copyAlt" class="btn">Copy Alt-text</button></div>
          </div>
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px">
          <div>
            <h3>Objects &amp; OCR</h3>
            <div id="objects" class="outbox mono">&mdash;</div>
            <div id="ocr" class="outbox mono" style="margin-top:8px">&mdash;</div>
          </div>
          <div>
            <h3>Palette &amp; EXIF</h3>
            <div id="palette" class="outbox mono" style="display:flex;gap:6px;flex-wrap:wrap;align-items:center"></div>
            <div id="exif" class="outbox mono" style="margin-top:8px">&mdash;</div>
          </div>
        </div>

        <div class="ad-wrap">
          <ins id="1101622" data-width="auto" data-height="250"></ins>
          <script>try{(adsbyjuicy=window.adsbyjuicy||[]).push({adzone:1101622});}catch(e){}</script>
        </div>

        <div class="card" id="faq" style="margin-top:12px">
          <h3>Help &amp; FAQ &mdash; hidden in plain sight (read this)</h3>
          <details open>
            <summary><strong>How do I get a likeness or "me as <em>anything</em>"?</strong></summary>
            <p class="sub">Use Face Mode to generate a prompt chunk + ratios. Paste into SDXL/Flux/MJ. For highest fidelity, fine-tune a local LoRA/DreamBooth using your photos; include exported landmarks/ratios as training metadata. You can then layer styles (e.g., cinematic ogre skin, swamp lighting) without losing identity.</p>
          </details>
          <details>
            <summary><strong>What's in the JSON export?</strong></summary>
            <p class="sub">Version, filename, image size; <code>prompt_chunk</code>; <code>palette</code>; <code>landmarks</code> (68-pt normalized); <code>measurements</code> ratios (jaw/face, eye-sep/eye-width, nose/face) plus px; and an <code>embedding</code> object. These are raw conditioning features for custom pipelines or training metadata.</p>
          </details>
          <details>
            <summary><strong>Privacy &amp; security?</strong></summary>
            <p class="sub">Everything runs in your browser unless you export. Do not analyze images without permission or of minors. This portal does not identify people; it provides descriptors for creative generation only. See Legal for policy.</p>
          </details>
          <details>
            <summary><strong>Best-results tips</strong></summary>
            <ul class="sub">
              <li>Use a sharp portrait (frontal or 3/4 view) with even light.</li>
              <li>Keep eyes visible; glasses may reduce landmark accuracy.</li>
              <li>When training a LoRA, include 10&ndash;20 varied shots and captions; add our JSON to your trainer as metadata.</li>
            </ul>
          </details>
        </div>

        <div class="ad-wrap">
          <ins id="1101675" data-width="auto" data-height="90"></ins>
          <script>try{(adsbyjuicy=window.adsbyjuicy||[]).push({adzone:1101675});}catch(e){}</script>
        </div>
      </section>
    </main>
  </div>

  <!-- ===== Consent Modal ===== -->
  <div id="consent" class="modal" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="sheet">
      <h3>Face Mapping &mdash; Consent</h3>
      <p class="sub">Analysis runs on-device. Only export if you choose. Use with consent; do not process minors. This is <em>not</em> an identity matcher.</p>
      <label style="display:flex;align-items:center;gap:8px"><input id="agree" type="checkbox"> <span>I own/have permission to analyze this image.</span></label>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px"><button id="deny" class="btn">Cancel</button><button id="accept" class="btn primary" disabled>Accept</button></div>
    </div>
  </div>

  <!-- ===== J1NX FLOAT + ANSI FOOTER (EXACT FROM YOUR SOURCE) ===== -->
  <!-- (pulled 1:1 from your standalone footer+J1NX demo) -->
  <style>
    :root { --bg:#0b0f14; --panel:#10161d; --edge:#232a33; --aqua:#64f2e3; --aqua2:#23d7ba; --ink:#d6f5ff; --dim:#9db1bd; --hot:#fa528e; --vio:#be9cff; --gold:#ffd166; }
    html,body{font-family:"Share Tech Mono",monospace;}
    .j1nx-float-true{position:fixed;z-index:4000;right:2vw;bottom:calc(2.8vh + 125px);display:flex;flex-direction:column;align-items:center;pointer-events:all;user-select:none;min-width:0;max-width:360px}
    .j1nx-true-cutout-img{width:320px;height:320px;object-fit:contain;border-radius:32px;background:transparent!important;margin-bottom:-30px;position:relative;z-index:9;pointer-events:auto;transition:box-shadow .2s;box-shadow:none!important}
    .j1nx-bubble-true-main{background:rgba(22,23,31,0.97);border-radius:17px;box-shadow:0 4px 22px #be9cff66,0 0 0 3px #23231f;border:2px solid var(--aqua);padding:1.1em 1.3em 1em 1.3em;margin-top:0;margin-bottom:.3em;display:flex;flex-direction:column;align-items:center;min-width:290px;max-width:330px;position:relative;z-index:1}
    .j1nx-bubble-text-true{font-size:1.05em;color:#fff;margin:.42em 0 .20em 0;text-align:center;font-weight:600;text-shadow:0 1px 11px #1e1111cc;line-height:1.22;z-index:1}
    .j1nx-bubble-row-true{width:100%;display:flex;justify-content:center;gap:7px;margin:.13em 0 .10em 0}
    .j1nx-input-true{flex:1;font-size:1em;border-radius:8px;padding:7px 12px;border:1px solid var(--aqua);background:#171b22;color:var(--aqua);min-width:0}
    .j1nx-btn-true{font-size:.98em;padding:6.5px 14px;border-radius:8px;background:#22252b;border:1.3px solid var(--aqua);color:var(--aqua);font-family:inherit;font-weight:600;cursor:pointer;transition:background .13s,color .13s,border .13s;box-shadow:0 1.5px 9px #be9cff33}
    .j1nx-btn-true:hover{background:var(--aqua);color:#171b22;border-color:#fff}
    .j1nx-easteregg-true{font-size:.91em;color:#be9cff;background:#171b22e6;border-radius:7px 13px 12px 17px;margin-top:7px;padding:7px 17px 6px 13px;opacity:.85;pointer-events:none;text-align:center;width:94%;user-select:none;box-shadow:0 3px 13px #be9cff28;font-weight:600}
    @media(max-width:900px){.j1nx-float-true{min-width:99vw;max-width:99vw;right:1vw}.j1nx-bubble-true-main{min-width:97vw;max-width:99vw}.j1nx-true-cutout-img{width:112px;height:112px}}
    @media(max-width:700px){.j1nx-float-true{min-width:99vw;max-width:99vw;right:1vw}.j1nx-bubble-true-main{min-width:98vw;max-width:99vw}.j1nx-true-cutout-img{width:66px;height:66px}}
    footer{margin:24px auto 0 auto;padding:0;text-align:center;max-width:820px;color:var(--ink)}
    .footer-art{margin:0 0 12px 0;font-family:"Fira Mono",monospace;font-size:.96em;color:#a1ffe3;line-height:1.1;letter-spacing:.2px;text-align:center;white-space:pre;user-select:text}
    .footer-camo{font-family:inherit;font-size:15px;line-height:1.11;letter-spacing:1.7px;margin:5px 0 12px 0;text-align:center;opacity:.93;white-space:pre}
    .footer-bar{color:#88fffd;margin:12px auto 8px auto;font-size:1.04em;text-align:center;display:flex;justify-content:center;align-items:center;gap:8px;flex-wrap:wrap}
    .footer-bar a{color:var(--aqua);text-decoration:none}
    .footer-bar a:hover{text-decoration:underline;color:#fff}
  </style>

  <div class="j1nx-float-true" id="j1nxFloatTrue">
    <img src="j1nx/j1nx_cutout.png" alt="J1nx" class="j1nx-true-cutout-img" id="j1nxCutoutTrue"/>
    <div class="j1nx-bubble-true-main" id="j1nxBubbleTrueMain">
      <div class="j1nx-bubble-text-true" id="j1nxBubbleTextTrue"><b>J1nx:</b> Hey you - I'm J1nx. Ready to stir up a little trouble, or do you want to keep it PG today? <br>(Don't worry, I'm good at both...)</div>
      <div class="j1nx-bubble-row-true">
        <input class="j1nx-input-true" id="j1nxInputTrue" placeholder="Say something to J1nx..." maxlength="120" autocomplete="off" />
        <button class="j1nx-btn-true" id="j1nxSendTrue">Send</button>
      </div>
      <div class="j1nx-bubble-row-true">
        <button class="j1nx-btn-true" id="j1nxClearTrue">Clear Chat</button>
        <button class="j1nx-btn-true" id="j1nxSaveTrue">Save Chat</button>
      </div>
      <div class="j1nx-easteregg-true" id="j1nxEasterEggTrue">Double-tap the chat bubble or type <b>'unlock'</b> to reveal NSFW mode...</div>
    </div>
  </div>

  <footer>
    <pre class="footer-art">
  ____      ____    U  ___ u  __  __    ____    _____    _____   U  ___ u   ____      ____  U _____ u   
U|  _"\ uU |  _"\ u  \/"_ \/U|' \/ '|uU|  _"\ u|_ " _|  |" ___|   \/"_ \/U |  _"\ uU /"___|u\| ___"|/   
\| |_) |/ \| |_) |/  | | | |\| |\/| |/\| |_) |/  | |   U| |_  u   | | | | \| |_) |/\| |  _ / |  _|"     
 |  __/    |  _ <.-,_| |_| | | |  | |  |  __/   /| |\  \|  _|/.-,_| |_| |  |  _ <   | |_| |  | |___     
 |_|       |_| \_\_)-\___/  |_|  |_|  |_|     u |_|U   |_|    \_)-\___/   |_| \_\   \____|  |_____|    
 ||>>_     //   \_    \   <<,-,,-.   ||>>_   _// \_  )(\,-      \     //   \_  _)(|_   <<   >>    
(__)__)   (__)  (__)  (__)   (./  \.) (__)__) (__) (__)(__)(_/     (__)   (__)  (__)(__)__) (__) (__)   
    </pre>
    <pre class="footer-camo" id="footerCamo"></pre>
    <div class="footer-bar">Made underground in BC, Canada • #PromptForge • <a href="https://bsky.app/profile/goreandgiggles.bsky.social">Bluesky</a> • <a href="https://x.com/GoreandGiggles">Twitter/X</a> • <a href="/legal.html">Legal</a></div>
  </footer>

  <!-- Footer camo animation + J1NX logic (verbatim from your file, ASCII-safe in JS literals) -->
  <script>
    (function(){
      const camoEl=document.getElementById("footerCamo");
      if(camoEl){
        const colors=["#64f2e3","#23d7ba","#4df6a0","#bdf6c3","#abffe6","#abb8b8"];
        // Using basic ASCII to avoid encoding pitfalls
        const chars="#%*+@X";
        function camoTick(t){
          let out="";
          for(let i=0;i<62;i++){
            out+=`<span style="color:${colors[(i+t)%colors.length]}">${chars[Math.floor(Math.random()*chars.length)]}</span>`;
          }
          camoEl.innerHTML=out;
        }
        let t=0; camoTick(0); setInterval(()=>camoTick(++t),950);
      }
    })();
    (function(){
      const j1nxFloat=document.getElementById('j1nxFloatTrue');
      const cutout=document.getElementById('j1nxCutoutTrue');
      const bubble=document.getElementById('j1nxBubbleTrueMain');
      function isMobile(){return window.innerWidth<700}
      function shrinkJ1nx(){if(isMobile()){j1nxFloat.classList.remove('j1nx-open');bubble.style.display='none'}else{j1nxFloat.classList.add('j1nx-open');bubble.style.display='flex'}}
      cutout.onclick=function(){if(isMobile()){if(j1nxFloat.classList.contains('j1nx-open')){j1nxFloat.classList.remove('j1nx-open');bubble.style.display='none'}else{j1nxFloat.classList.add('j1nx-open');bubble.style.display='flex'}}};
      window.addEventListener('resize',shrinkJ1nx);shrinkJ1nx();
    })();
    (function(){
      let chatHistory=[];let nsfwUnlocked=false;
      function renderChat(){
        const out=chatHistory.map(line=>`<div>${line}</div>`).join('');
        document.getElementById('j1nxBubbleTextTrue').innerHTML= out || "<b>J1nx:</b> Hey you - I'm J1nx. Ready to stir up a little trouble, or do you want to keep it PG today?<br>(Don't worry, I'm good at both...)";
      }
      function addMsg(msg,isUser){ if(!msg) return; const name=isUser?"<b>You:</b> ":"<b>J1nx:</b> "; chatHistory.push(name+msg); if(chatHistory.length>8) chatHistory=chatHistory.slice(-8); renderChat(); }
      document.getElementById('j1nxBubbleTrueMain').addEventListener('dblclick',function(){ nsfwUnlocked=true; document.getElementById('j1nxEasterEggTrue').innerHTML="<b>NSFW mode unlocked!</b> You're now in uncensored mode. Type anything..."; addMsg("NSFW mode unlocked! You're now in uncensored mode.",false); });
      document.getElementById('j1nxSendTrue').onclick=function(){
        const input=document.getElementById('j1nxInputTrue');
        const val=(input.value||'').trim();
        if(!val) return;
        addMsg(val,true);
        if(/^unlock$/i.test(val)){
          nsfwUnlocked=true;
          document.getElementById('j1nxEasterEggTrue').innerHTML="<b>NSFW mode unlocked!</b> You're now in uncensored mode. Type anything...";
          addMsg("NSFW mode unlocked! You're now in uncensored mode.",false);
          input.value='';
          return;
        }
        try{
          let reply=window.j1nxBrain(val,chatHistory.length,nsfwUnlocked);
          let replyText=(reply&&typeof reply==='object')?(reply.text||reply.reply||JSON.stringify(reply)):reply;
          addMsg(replyText,false);
        }catch(e){ addMsg("Sorry, my brain glitched... (Check assets/j1nx_brain.js)",false); }
        input.value='';
      };
      document.getElementById('j1nxInputTrue').addEventListener('keydown',function(e){ if(e.key==='Enter') document.getElementById('j1nxSendTrue').click(); });
      document.getElementById('j1nxSaveTrue').onclick=function(){
        const text=chatHistory.map(line=>line.replace(/<[^>]+>/g,'')).join('
');
        const blob=new Blob([text],{type:'text/plain'});
        const url=URL.createObjectURL(blob);
        const a=document.createElement('a'); a.href=url; a.download='j1nx_chat.txt'; document.body.appendChild(a); a.click();
        setTimeout(()=>{document.body.removeChild(a); URL.revokeObjectURL(url);},300);
      };
      document.getElementById('j1nxClearTrue').onclick=function(){ chatHistory=[]; renderChat(); };
      renderChat();
    })();
  </script>
  <script src="assets/j1nx_brain.js"></script>

  <!-- ===== Core App + Animated Scan Effect + Real AI wires ===== -->
  <script>
    const $=s=>document.querySelector(s);
    const preview=$('#preview'), overlay=$('#overlay');
    const pctx=preview.getContext('2d'), octx=overlay.getContext('2d');
    const state={img:null, consented:false, faceReady:false, models:{}, scan:{y:0,dir:1,anim:null}};

    // Choose
    document.getElementById('chooseBtn').addEventListener('click',()=>$('#file').click());

    // Load image
    $('#file').addEventListener('change',ev=>{const f=ev.target.files[0]; if(!f) return; const img=new Image(); img.onload=()=>{state.img=img; const r=img.width/img.height; preview.height=Math.round(preview.width/r); overlay.height=preview.height; pctx.clearRect(0,0,preview.width,preview.height); pctx.drawImage(img,0,0,preview.width,preview.height); $('#analyze').disabled=true; $('#caption').value='—'; $('#objects').textContent='—'; $('#ocr').textContent='—'; $('#exif').textContent=`${img.naturalWidth}×${img.naturalHeight} px`; extractPalette(); startScan(); setTimeout(()=>{$('#analyze').disabled=false;},150);}; img.src=URL.createObjectURL(f)});

    // Consent
    const modal=$('#consent'), accept=$('#accept'), agree=$('#agree'), deny=$('#deny');
    $('#enable-face').addEventListener('click',()=>{modal.classList.add('open')});
    agree.addEventListener('change',()=>{accept.disabled=!agree.checked});
    deny.addEventListener('click',()=>modal.classList.remove('open'));
    accept.addEventListener('click',()=>{state.consented=true; modal.classList.remove('open'); ensureFace().catch(()=>{})});

    // Analyze (fast = palette + heuristic caption; Full-AI adds models)
    $('#analyze').addEventListener('click',async()=>{
      if(!state.img) return;
      const quick=heuristicCaption();
      $('#caption').value=quick;
      if(state.faceReady){ await drawFaceOverlay(); }
    });

    // Enable Full-AI: load captioning, detection, OCR
    $('#enable-ai').addEventListener('click',async()=>{
      $('#progress').textContent='Loading models...';
      try{ await ensureCaptionModel(); $('#progress').textContent='Caption ready...'; }catch(e){ $('#progress').textContent='Caption failed to load'; }
      try{ await ensureCoco(); $('#progress').textContent+=" Objects ready..."; }catch(e){ $('#progress').textContent+=" Objects failed..."; }
      try{ await ensureOCR(); $('#progress').textContent+=" OCR ready."; }catch(e){ $('#progress').textContent+=" OCR failed."; }
      // Run them once
      if(state.img){ try{ const cap=await runCaption(); if(cap) $('#caption').value=cap; }catch(e){}
        try{ const tags=await runDetection(); if(tags) $('#objects').textContent=tags; }catch(e){}
        try{ const text=await runOCR(); if(text) $('#ocr').textContent=text; }catch(e){} }
    });

    // Build prompt
    $('#build').addEventListener('click',async()=>{
      const cap=$('#caption').value.trim();
      let faceChunk=''; if(state.faceReady) faceChunk= await buildFaceChunk();
      const obj=$('#objects').textContent.replace(/—/g,'').trim();
      const ocr=$('#ocr').textContent.replace(/—/g,'').trim();
      const pal=[...$('#palette').querySelectorAll('span')].map(s=>s.title).slice(0,5).join(', ');
      const parts=[cap,faceChunk,obj?`objects: ${obj}`:'',ocr?`visible text: ${ocr}`:'',pal?`palette: ${pal}`:''].filter(Boolean);
      $('#promptOut').value=parts.join('
')+"
Negative: low quality, artifacts, watermark";
    });

    // Export JSON
    $('#exportJSON').addEventListener('click',()=>{
      const data={version:'1.0',source_filename:($('#file').files[0]?.name||''),timestamp:Date.now(),image_size:{width:state.img?.naturalWidth||0,height:state.img?.naturalHeight||0},prompt_chunk:$('#promptOut').value.split('
')[0]||'',alt_text:$('#caption').value||'',palette:[...$('#palette').querySelectorAll('span')].map(s=>s.title),landmarks: state.landmarks || null,embedding: state.embedding || null,measurements: state.measurements || null};
      const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='promptforge_export.json'; a.click();
    });

    // Copy helpers
    $('#copyPrompt').addEventListener('click',()=>{const t=$('#promptOut'); t.select(); document.execCommand('copy')});
    $('#copyAlt').addEventListener('click',()=>{const v=($('#caption').value||'').trim()||'alt text'; navigator.clipboard.writeText(v)});

    // === Face overlay ===
    async function ensureFace(){ if(state.faceReady||!state.consented) return true; await addScript('https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js'); const base='https://cdn.jsdelivr.net/gh/justadudewhohacks/face-api.js@0.22.2/weights'; await Promise.all([ faceapi.nets.tinyFaceDetector.loadFromUri(base), faceapi.nets.faceLandmark68TinyNet.loadFromUri(base) ]); state.faceReady=true; return true; }
    async function drawFaceOverlay(){ if(!state.img||!state.faceReady) return; octx.clearRect(0,0,overlay.width,overlay.height); const det=await faceapi.detectAllFaces(preview,new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks(true); if(!det.length){ state.landmarks=null; state.measurements=null; return; } const best=det.sort((a,b)=>b.detection.box.area - a.detection.box.area)[0]; faceapi.draw.drawDetections(overlay,[best.detection]); faceapi.draw.drawFaceLandmarks(overlay,best); const lm=best.landmarks.positions; octx.strokeStyle='rgba(100,242,227,.85)'; octx.lineWidth=1.5; line(lm[36],lm[39]); line(lm[42],lm[45]); line(lm[39],lm[42]); line(lm[3],lm[13]); line(lm[27],lm[8]); line(lm[31],lm[35]); const m={}; m.eye_left_w=dist(lm[36],lm[39]); m.eye_right_w=dist(lm[42],lm[45]); m.eye_sep=dist(lm[39],lm[42]); m.jaw_w=dist(lm[3],lm[13]); m.face_h=dist(lm[27],lm[8]); m.nose_w=dist(lm[31],lm[35]); m.eye_sep_to_width=m.eye_sep/((m.eye_left_w+m.eye_right_w)/2); m.jaw_to_face=m.jaw_w/m.face_h; m.nose_to_face=m.nose_w/m.face_h; state.measurements={units:'px',norm:true,values:m}; state.landmarks={format:'68pts-normalized',points:lm.map((p,i)=>({i,x:p.x/overlay.width,y:p.y/overlay.height}))}; document.getElementById('legend').textContent=`Ratios - jaw/face: ${fmt(m.jaw_to_face)}, eye-sep/eye-w: ${fmt(m.eye_sep_to_width)}, nose/face: ${fmt(m.nose_to_face)}`; }
    function line(a,b){ octx.beginPath(); octx.moveTo(a.x,a.y); octx.lineTo(b.x,b.y); octx.stroke(); }
    function dist(a,b){ const dx=a.x-b.x, dy=a.y-b.y; return Math.hypot(dx,dy); }
    function fmt(n){ return (Math.round(n*100)/100).toFixed(2); }
    async function buildFaceChunk(){ if(!state.measurements) return ''; const r=state.measurements.values; const shape=r.jaw_to_face>0.85?'strong jawline':r.jaw_to_face<0.7?'narrow jawline':'soft jawline'; const eyes=r.eye_sep_to_width>1.9?'wide-set eyes':r.eye_sep_to_width<1.5?'close-set eyes':'balanced eye spacing'; const nose=r.nose_to_face>0.32?'long straight nose':'shorter nose'; return `face: ${shape}, ${eyes}, ${nose}`; }

    // === Animated scan effect (Hollywood vibe) ===
    function startScan(){ cancelAnimationFrame(state.scan.anim); state.scan.y=0; state.scan.dir=1; const step=()=>{ octx.clearRect(0,0,overlay.width,overlay.height); // faint grid
        octx.strokeStyle='rgba(100,242,227,.08)'; octx.lineWidth=1; for(let x=0;x<overlay.width;x+=24){octx.beginPath();octx.moveTo(x,0);octx.lineTo(x,overlay.height);octx.stroke()} for(let y=0;y<overlay.height;y+=24){octx.beginPath();octx.moveTo(0,y);octx.lineTo(overlay.width,y);octx.stroke()} // scanning bar
        const y=state.scan.y; const grad=octx.createLinearGradient(0,y-20,0,y+20); grad.addColorStop(0,'rgba(35,215,186,0)'); grad.addColorStop(0.5,'rgba(35,215,186,.35)'); grad.addColorStop(1,'rgba(35,215,186,0)'); octx.fillStyle=grad; octx.fillRect(0,y-20,overlay.width,40); state.scan.y+=state.scan.dir*3; if(state.scan.y>overlay.height||state.scan.y<0){state.scan.dir*=-1} state.scan.anim=requestAnimationFrame(step)}; state.scan.anim=requestAnimationFrame(step)}

    // === Palette + heuristic caption (works without external models) ===
    function extractPalette(){ const n=6; const w=preview.width,h=preview.height; const data=pctx.getImageData(0,0,w,h).data; const buckets={}; for(let i=0;i<data.length;i+=4*16){ const r=data[i],g=data[i+1],b=data[i+2]; const key=`${r>>4}-${g>>4}-${b>>4}`; buckets[key]=(buckets[key]||0)+1;} const top=Object.entries(buckets).sort((a,b)=>b[1]-a[1]).slice(0,n).map(([k])=>k.split('-').map(x=>parseInt(x,10)<<4)); const hex=top.map(([r,g,b])=>`#${toHex(r)}${toHex(g)}${toHex(b)}`); document.getElementById('palette').innerHTML=hex.map(h=>`<span class="mono" style="display:inline-block;width:22px;height:22px;border-radius:6px;border:1px solid #0003;background:${h}" title="${h}"></span>`).join(''); function toHex(v){return v.toString(16).padStart(2,'0')} }
    function heuristicCaption(){ // simple vibe based on palette brightness/contrast
      const w=preview.width,h=preview.height; const img=pctx.getImageData(0,0,w,h).data; let l=0,cnt=0; for(let i=0;i<img.length;i+=16){ const r=img[i],g=img[i+1],b=img[i+2]; l+=(0.2126*r+0.7152*g+0.0722*b); cnt++; } const avg=l/ (cnt*255); const mood=avg>0.7?'bright, airy light':avg<0.35?'low-key, moody light':'neutral, soft light'; return `A ${mood} photograph with ${document.querySelectorAll('#palette span').length||'balanced'} tonal palette; subject centered; clean background.` }

    // === Full-AI wires ===
    async function addScript(src){ return new Promise((res,rej)=>{ const s=document.createElement('script'); s.src=src; s.async=true; s.onload=()=>res(true); s.onerror=rej; document.head.appendChild(s); }); }

    // Caption (Transformers.js Xenova ViT-GPT2)
    async function ensureCaptionModel(){ if(state.models.caption) return; await addScript('https://cdn.jsdelivr.net/npm/@xenova/transformers@3.2.1/dist/transformers.min.js'); state.models.caption=true; }
    async function runCaption(){ if(!window.transformers||!state.img) return ''; const { pipeline } = window.transformers; state.pipe = state.pipe || await pipeline('image-to-text','Xenova/vit-gpt2-image-captioning'); const out = await state.pipe(preview); return (out && out[0] && out[0].generated_text) ? out[0].generated_text : ''; }

    // Objects (TensorFlow.js + COCO-SSD)
    async function ensureCoco(){ if(state.models.coco) return; await addScript('https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.20.0/dist/tf.min.js'); await addScript('https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.3/dist/coco-ssd.min.js'); state.models.coco=true; }
    async function runDetection(){ if(!window.cocoSsd) return ''; const model = state.cocoModel || await window.cocoSsd.load(); state.cocoModel=model; const preds=await model.detect(preview); const list=preds.filter(p=>p.score>0.35).slice(0,8).map(p=>`${p.class} (${Math.round(p.score*100)}%)`); document.getElementById('objects').textContent=list.join(', '); return document.getElementById('objects').textContent; }

    // OCR (Tesseract.js)
    async function ensureOCR(){ if(state.models.ocr) return; await addScript('https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js'); state.models.ocr=true; }
    async function runOCR(){ if(!window.Tesseract) return ''; const worker=await window.Tesseract.createWorker('eng'); const dataURL=preview.toDataURL(); const { data:{ text } } = await worker.recognize(dataURL); await worker.terminate(); return (text||'').trim(); }

    // ====== Tiny self-tests (helps catch regressions) ======
    (function SelfTest(){
      try{
        const a=['one','two']; const joined=a.join('
'); if(joined.indexOf('
')===-1) throw new Error('Join newline failed');
        const sample={x:10,y:10}, sample2={x:13,y:14}; const d=Math.hypot(sample.x-sample2.x,sample.y-sample2.y); if(!(d>0)) throw new Error('Distance calc failed');
        console.log('[Image-Intel] Self-test OK');
      }catch(e){ console.warn('[Image-Intel] Self-test FAILED', e); }
    })();
  </script>

  <!-- JuicyAds loader (once, global) -->
  <script async src="https://poweredby.jads.co/js/jads.js"></script>
</body>
</html>
