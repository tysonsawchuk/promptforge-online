<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Watermark Maker – Pro, Free, & Fully Custom | PromptForge.online</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="Create stunning, custom watermarks—free, pro-grade, always. Make, design, and install your own digital watermark or signature. No login, no limits, every feature unlocked.">
  <link rel="icon" href="/assets/pf-fav.png">
  <style>
    body { background: #18131c; color: #fff2fd; margin: 0; font-family: 'Segoe UI', Arial, sans-serif; min-height: 100vh; }
    header, footer { background: #21192a; color: #ffd6fd; padding: 22px 0 16px 0; text-align: center; font-weight: 600; font-size: 1.19em; letter-spacing: .02em; }
    nav { margin: 0 auto 10px auto; padding: 0 0 4px 0; text-align: center; background: #271c34; border-bottom: 2px solid #fa528e38; }
    nav a { color: #ffb1ef; text-decoration: none; margin: 0 15px; font-weight: bold; font-size: 1.03em; transition: color .18s; }
    nav a:hover { color: #fa528e; }
    main { width: 100%; max-width: 1200px; margin: 24px auto 18px auto; padding: 0 5vw; box-sizing: border-box; }
    .big-title { font-size: 2.12em; font-weight: 800; color: #fa528e; text-shadow: 0 1px 14px #fd5dc760, 0 0px 2px #000; margin: 10px 0 16px 0; line-height: 1.09; }
    .desc-blurb { background: #1f142b; color: #ffe2fb; padding: 18px 24px; border-radius: 19px; font-size: 1.09em; margin-bottom: 20px; box-shadow: 0 2px 19px #fd5dc740; line-height: 1.6; max-width: 940px; margin-left: auto; margin-right: auto; }
    .watermark-toolbox { background: #18121d; border-radius: 22px; padding: 27px 12px 27px 12px; margin: 0 auto 27px auto; box-shadow: 0 2px 19px #ff43ae22; max-width: 980px; overflow-x: auto; }
    .section-title { color: #fa528e; font-size: 1.3em; font-weight: bold; margin: 24px 0 7px 0; text-shadow: 0 1px 8px #fd5dc750; letter-spacing: .01em; }
    .micro-help-btn { display: inline-block; width: 20px; height: 20px; background: #ecebee; color: #222; border-radius: 50%; text-align: center; font-size: 1.16em; font-weight: 700; line-height: 20px; margin-left: 8px; box-shadow: 0 2px 6px #fa528e19; cursor: pointer; user-select: none; transition: background .18s; border: 1.5px solid #ccc; vertical-align: middle; }
    .micro-help-btn:hover { background: #f4def3; color: #d50060; }
    .micro-help-popup { position: absolute; background: #efeefa; color: #1a1022; padding: 13px 18px; border-radius: 13px; box-shadow: 0 2px 18px #fa528e33; font-size: 1.03em; z-index: 330; min-width: 158px; max-width: 310px; line-height: 1.46; border: 1.5px solid #fa528e19; top: 0; left: 0; display: none; }
    .micro-help-popup.active { display: block; animation: fadeIn .22s; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px);} to   { opacity: 1; transform: translateY(0);} }
    /* --- Watermark UI styles, canvas, toolbars, gallery, template picker, everything from last working version goes here --- */
    .wm-section { margin-bottom: 23px; }
    .wm-label { color: #fd8ac7; font-size: 1.08em; font-weight: bold; margin-right: 9px; }
    .wm-toolbar { margin: 0 0 12px 0; padding: 7px 0 8px 0; display: flex; flex-wrap: wrap; gap: 13px; align-items: center; }
    .wm-btn { background: #fa528e; color: #fff; border: none; border-radius: 7px; padding: 8px 13px; font-weight: 700; font-size: .96em; cursor: pointer; transition: background .2s; box-shadow: 0 2px 8px #fa528e19; }
    .wm-btn:hover { background: #fd5dc7; color: #1c1018; }
    .wm-input, .wm-select { border: none; border-radius: 7px; padding: 7px 11px; font-size: 1em; background: #1a1221; color: #fff1fd; margin-right: 9px; box-shadow: 0 2px 6px #fa528e15 inset; }
    .wm-canvas-area { background: #201622; border-radius: 22px; padding: 15px; margin-bottom: 16px; box-shadow: 0 2px 19px #ff43ae13; text-align: center; }
    #wm-canvas { background: #fff2; border-radius: 13px; border: 2px dashed #fa528e40; }
    .wm-templates { display: flex; flex-wrap: wrap; gap: 13px; margin-bottom: 16px; }
    .wm-template-thumb { border-radius: 8px; border: 2px solid #fa528e13; background: #232029; cursor: pointer; width: 72px; height: 72px; object-fit: contain; transition: box-shadow .18s, border .18s; }
    .wm-template-thumb:hover, .wm-template-thumb.active { border: 2px solid #fa528e; box-shadow: 0 2px 16px #fa528e30; }
    .wm-gallery { display: flex; flex-wrap: wrap; gap: 17px; }
    .wm-gallery-img { width: 150px; height: 100px; object-fit: contain; border-radius: 9px; background: #191919; border: 2px solid #fa528e22; }
    /* --- End Watermark UI styles --- */
    /* MINI J1NX CAMPER */
    #j1nx-mini-camper { position: fixed; bottom: 22px; right: 22px; z-index: 97; display: flex; align-items: flex-end; gap: 9px; user-select: none; }
    #j1nx-mini-art { width: 68px; height: auto; min-height: 54px; max-height: 99px; box-shadow: 0 2px 16px #fa528e55; border-radius: 20px 20px 40px 40px/35px 35px 76px 76px; object-fit: contain; background: #18101a; }
    #j1nx-mini-bubble-container { display: flex; flex-direction: column; align-items: flex-start; min-width: 230px; max-width: 330px; }
    #j1nx-mini-bubble { background: #222; color: #ffe2fb; font-size: 1.09em; border-radius: 16px 16px 22px 22px/18px 18px 29px 29px; box-shadow: 0 2px 18px #fa528e33; padding: 11px 15px 9px 18px; margin-bottom: 6px; max-width: 330px; min-width: 160px; max-height: 114px; overflow-y: auto; word-break: break-word; line-height: 1.44; transition: box-shadow .3s; }
    #j1nx-mini-input { width: 97%; border: none; border-radius: 8px; padding: 6px 9px; font-size: 1em; margin-bottom: 5px; background: #18101a; color: #ffd6fd; box-shadow: 0 2px 8px #fa528e18 inset; outline: none; }
    @media (max-width: 700px) { #j1nx-mini-camper { bottom: 9px; right: 2px; } #j1nx-mini-art { width: 43px; min-height: 34px; } #j1nx-mini-bubble-container { min-width: 140px; max-width: 98vw; } #j1nx-mini-bubble { font-size: .97em; max-width: 98vw; } }
  </style>
</head>
<body>
<header>
  Watermark Maker – PromptForge.online
</header>
<nav>
  <a href="/main.html">Main Hub</a>
  <a href="/pic.html">Image Prompts</a>
  <a href="/movie.html">Video Prompts</a>
  <a href="/j1nx.html">J1nx</a>
  <a href="/watermark.html">Watermark</a>
  <a href="/aihacks.html">AI Hacks</a>
  <a href="/ansiart.html">ANSI Art</a>
  <a href="/compare.html">Compare</a>
  <a href="/terms.html">Legal</a>
</nav>
<main>
  <div class="big-title">Watermark Maker – Free, Pro, & Fully Custom</div>
  <div class="desc-blurb">
    <b>The most powerful, full-featured watermark tool on the web.</b><br>
    Make, design, and apply your own digital watermark or signature—<u>all free</u>, no login, every pro feature unlocked.<br>
    <ul style="margin-top:9px;margin-bottom:0;padding-left:20px;">
      <li>Create text, logo, or drawn watermarks</li>
      <li>Pick templates or upload your own</li>
      <li>Edit fonts, colors, angles, opacity, blend, & more</li>
      <li>Preview instantly and export to PNG</li>
      <li>Batch watermark mode for multiple pics</li>
      <li>Gallery, signature box, and inspiration prompts</li>
    </ul>
    <b>No paywalls. No limits. <span style="color:#fa528e;">Just watermark like a boss.</span></b>
  </div>
  <!-- MAIN TOOLBOX -->
  <div class="watermark-toolbox">
    <div class="section-title">
      1. Start Your Watermark
      <span class="micro-help-btn" data-help="start">?</span>
    </div>
    <div class="wm-toolbar">
      <label class="wm-label" for="wm-text">Text:</label>
      <input class="wm-input" type="text" id="wm-text" placeholder="Your watermark (e.g. @yourname, Copyright…)" maxlength="80">
      <label class="wm-label" for="wm-font">Font:</label>
      <select class="wm-select" id="wm-font">
        <option value="Segoe UI" selected>Segoe UI</option>
        <option value="Arial">Arial</option>
        <option value="Montserrat">Montserrat</option>
        <option value="Oswald">Oswald</option>
        <option value="Pacifico">Pacifico (Handwritten)</option>
        <option value="Roboto">Roboto</option>
        <option value="Teko">Teko</option>
        <option value="Impact">Impact</option>
        <option value="Courier New">Courier New</option>
      </select>
      <label class="wm-label" for="wm-size">Size:</label>
      <input class="wm-input" type="number" id="wm-size" value="44" min="10" max="160" style="width: 58px;">
      <label class="wm-label" for="wm-color">Color:</label>
      <input class="wm-input" type="color" id="wm-color" value="#fa528e" style="width:36px;">
      <label class="wm-label" for="wm-alpha">Opacity:</label>
      <input class="wm-input" type="range" id="wm-alpha" min="20" max="100" value="70" style="width: 80px;">
      <span id="wm-alpha-val" style="color:#ffb1ef;font-size:.96em;">70%</span>
      <button class="wm-btn" onclick="resetWatermark()">Reset</button>
    </div>

    <div class="section-title">
      2. Add Logo, Signature, or Shape
      <span class="micro-help-btn" data-help="logo">?</span>
    </div>
    <div class="wm-toolbar">
      <input class="wm-input" type="file" id="wm-upload" accept="image/png, image/jpeg, image/svg+xml">
      <button class="wm-btn" onclick="clearLogo()">Clear Logo</button>
      <div style="margin-left:10px;">
        <span class="wm-label">Or pick a template:</span>
        <div class="wm-templates" id="wm-templates">
          <!-- Will be filled by JS with /assets/watermark_templates/*.png -->
        </div>
      </div>
    </div>

    <div class="section-title">
      3. Draw Your Own (Signature Box)
      <span class="micro-help-btn" data-help="draw">?</span>
    </div>
    <div class="wm-canvas-area">
      <canvas id="wm-canvas" width="420" height="110"></canvas>
      <div style="margin-top:8px;">
        <button class="wm-btn" onclick="clearCanvas()">Clear</button>
        <button class="wm-btn" onclick="undoDraw()">Undo</button>
        <button class="wm-btn" onclick="downloadSignature()">Save Signature</button>
      </div>
    </div>

    <div class="section-title">
      4. Preview and Place Watermark
      <span class="micro-help-btn" data-help="preview">?</span>
    </div>
    <div style="display:flex;flex-wrap:wrap;gap:18px;align-items:flex-end;">
      <div style="flex:1;">
        <canvas id="wm-preview" width="530" height="340"
          style="background:#232029;border-radius:18px;border:2px solid #fa528e22;margin-bottom:9px;"></canvas>
      </div>
      <div style="flex-basis:180px;">
        <label class="wm-label" for="wm-angle">Angle:</label>
        <input class="wm-input" type="number" id="wm-angle" value="0" min="-90" max="90" style="width:54px;">
        <label class="wm-label" for="wm-pos-x">X:</label>
        <input class="wm-input" type="number" id="wm-pos-x" value="50" min="0" max="530" style="width:54px;">
        <label class="wm-label" for="wm-pos-y">Y:</label>
        <input class="wm-input" type="number" id="wm-pos-y" value="300" min="0" max="340" style="width:54px;">
      </div>
    </div>

    <div class="section-title">
      5. Export, Download, or Batch
      <span class="micro-help-btn" data-help="export">?</span>
    </div>
    <div class="wm-toolbar">
      <button class="wm-btn" onclick="downloadWatermark()">Download PNG</button>
      <input class="wm-input" type="file" id="batch-upload" multiple accept="image/png, image/jpeg">
      <button class="wm-btn" onclick="batchApply()">Batch Apply</button>
      <button class="wm-btn" onclick="saveWatermarkLocal()">Save Watermark (Local)</button>
      <button class="wm-btn" onclick="loadWatermarkLocal()">Load Saved</button>
    </div>
  </div>
  <!-- GALLERY + INSPIRATION -->
  <div class="watermark-toolbox">
    <div class="section-title">
      6. Gallery & Inspiration
      <span class="micro-help-btn" data-help="gallery">?</span>
    </div>
    <div class="wm-gallery" id="wm-gallery">
      <!-- Example watermarked images; will be filled by JS with samples -->
    </div>
    <div style="margin: 17px 0 0 0; color: #fd8ac7; font-size: 1.03em;">
      <b>Not sure what to make?</b>
      <button class="wm-btn" onclick="showInspiration()">Get Watermark Idea</button>
      <span id="wm-inspire" style="margin-left: 13px; color: #fff1fd;"></span>
    </div>
  </div>
</main>

<!-- MINI J1NX CAMPER WITH TYPE-TO-J1NX, DYNAMIC BUBBLE -->
<div id="j1nx-mini-camper">
  <img id="j1nx-mini-art" src="/j1nx/j1nx_cutout.png" alt="J1nx">
  <div id="j1nx-mini-bubble-container">
    <div id="j1nx-mini-bubble">Hi! I’m J1nx—need watermark help? Type to me!</div>
    <input id="j1nx-mini-input" type="text" placeholder="Ask J1nx for help…" maxlength="120"
      onkeydown="if(event.key==='Enter'){j1nxChat()}" autocomplete="off">
  </div>
</div>

<footer>
  &copy; 2025 PromptForge.online &mdash; All watermark features are free, pro, and always yours.<br>
  <a href="https://bsky.app/profile/goreandgiggles.bsky.social" target="_blank" style="color:#ffb1ef;">Bluesky</a> &middot;
  <a href="https://x.com/GoreandGiggles" target="_blank" style="color:#ffb1ef;">X/Twitter</a> &middot;
  <a href="https://www.facebook.com/groups/393971833395749" target="_blank" style="color:#ffb1ef;">Facebook</a>
</footer>

<!-- Ad block (discreet) -->
<div style="max-width:420px;margin:36px auto 14px auto;">
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-4963053724895140"
       data-ad-slot="4315819721"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4963053724895140" crossorigin="anonymous"></script>
  <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</div>
<!-- LOAD J1NX BRAIN -->
<script src="/assets/j1nx_brain.js"></script>

<script>
// ============ MICRO HELP ================
const helpContent = {
  start: "Enter your watermark text, pick your favorite font, adjust size, color, and opacity. Everything updates instantly.",
  logo: "Upload a logo, signature, or PNG/SVG to add to your watermark. Or click any template below.",
  draw: "Draw your signature or a shape right here! Use 'Save Signature' to export it as a PNG, or add it to your watermark.",
  preview: "Preview your watermark on a blank image. Use the controls to rotate, resize, and move your mark.",
  export: "Download your watermark as a PNG. Batch mode: select multiple images to apply your watermark to all.",
  gallery: "See watermarked examples. Click 'Get Watermark Idea' for random inspiration or pro tips!"
};
let activeHelpPopup = null;
document.querySelectorAll('.micro-help-btn').forEach(btn => {
  btn.addEventListener('click', function(e) {
    e.stopPropagation();
    if(activeHelpPopup) activeHelpPopup.remove();
    const rect = btn.getBoundingClientRect();
    const helpKey = btn.getAttribute('data-help');
    const helpText = helpContent[helpKey] || "Help not found.";
    const popup = document.createElement('div');
    popup.className = 'micro-help-popup active';
    popup.textContent = helpText;
    document.body.appendChild(popup);
    let top = window.scrollY + rect.top - popup.offsetHeight - 6;
    if(top < 40) top = window.scrollY + rect.bottom + 8;
    let left = window.scrollX + rect.left;
    if(left + popup.offsetWidth > window.innerWidth - 24) {
      left = window.innerWidth - popup.offsetWidth - 22;
    }
    popup.style.top = `${top}px`;
    popup.style.left = `${left}px`;
    activeHelpPopup = popup;
    document.addEventListener('click', dismissHelp, { once:true });
  });
});
function dismissHelp() {
  if(activeHelpPopup) activeHelpPopup.remove();
  activeHelpPopup = null;
}
document.addEventListener('keydown', function(e) {
  if(e.key === "Escape") dismissHelp();
});

// ============ WATERMARK TOOL LOGIC ================
let watermarkText = "© Your Name";
let watermarkFont = "Segoe UI";
let watermarkSize = 44;
let watermarkColor = "#fa528e";
let watermarkAlpha = 0.7;
let watermarkLogo = null;
let watermarkLogoImage = null;
let watermarkAngle = 0;
let watermarkPosX = 50, watermarkPosY = 300;
let signatureImage = null;

const textInput = document.getElementById('wm-text');
const fontInput = document.getElementById('wm-font');
const sizeInput = document.getElementById('wm-size');
const colorInput = document.getElementById('wm-color');
const alphaInput = document.getElementById('wm-alpha');
const alphaVal = document.getElementById('wm-alpha-val');
const angleInput = document.getElementById('wm-angle');
const posXInput = document.getElementById('wm-pos-x');
const posYInput = document.getElementById('wm-pos-y');

function updateAllInputs() {
  textInput.value = watermarkText;
  fontInput.value = watermarkFont;
  sizeInput.value = watermarkSize;
  colorInput.value = watermarkColor;
  alphaInput.value = Math.round(watermarkAlpha * 100);
  alphaVal.textContent = Math.round(watermarkAlpha * 100) + "%";
  angleInput.value = watermarkAngle;
  posXInput.value = watermarkPosX;
  posYInput.value = watermarkPosY;
}
updateAllInputs();

[textInput, fontInput, sizeInput, colorInput, alphaInput, angleInput, posXInput, posYInput].forEach(inp => {
  inp.addEventListener('input', function() {
    watermarkText = textInput.value;
    watermarkFont = fontInput.value;
    watermarkSize = parseInt(sizeInput.value,10);
    watermarkColor = colorInput.value;
    watermarkAlpha = parseInt(alphaInput.value,10)/100;
    alphaVal.textContent = Math.round(watermarkAlpha * 100) + "%";
    watermarkAngle = parseInt(angleInput.value,10);
    watermarkPosX = parseInt(posXInput.value,10);
    watermarkPosY = parseInt(posYInput.value,10);
    renderPreview();
  });
});

// ============ LOGO / TEMPLATE HANDLING ============
document.getElementById('wm-upload').addEventListener('change', function(e) {
  if(!e.target.files.length) return;
  let file = e.target.files[0];
  let reader = new FileReader();
  reader.onload = function(evt) {
    watermarkLogo = evt.target.result;
    watermarkLogoImage = new window.Image();
    watermarkLogoImage.onload = renderPreview;
    watermarkLogoImage.src = watermarkLogo;
  };
  reader.readAsDataURL(file);
});

function clearLogo() {
  watermarkLogo = null;
  watermarkLogoImage = null;
  renderPreview();
}

function fetchTemplates() {
  // These files should exist in /assets/watermark_templates/
  let templates = [
    "signature1.png",
    "stamp1.png",
    "logo1.png",
    "modern1.png",
    "handwritten1.png"
  ];
  let container = document.getElementById('wm-templates');
  templates.forEach(name => {
    let img = document.createElement('img');
    img.src = "/assets/watermark_templates/" + name;
    img.className = "wm-template-thumb";
    img.title = name.replace(/\.png$/,'').replace(/\d/,'').replace(/_/g,' ').toUpperCase();
    img.addEventListener('click', () => {
      watermarkLogo = img.src;
      watermarkLogoImage = new window.Image();
      watermarkLogoImage.onload = renderPreview;
      watermarkLogoImage.src = watermarkLogo;
    });
    container.appendChild(img);
  });
}
fetchTemplates();

// ============ SIGNATURE DRAWING LOGIC ============
const canvas = document.getElementById('wm-canvas');
const ctx = canvas.getContext('2d');
let drawing = false, paths = [], undone = [];
canvas.addEventListener('mousedown', e => { drawing = true; paths.push([{x:e.offsetX,y:e.offsetY}]); });
canvas.addEventListener('mouseup', () => { drawing = false; });
canvas.addEventListener('mouseout', () => { drawing = false; });
canvas.addEventListener('mousemove', function(e){
  if (!drawing) return;
  let pt = {x:e.offsetX, y:e.offsetY};
  paths[paths.length-1].push(pt);
  redrawCanvas();
});
function redrawCanvas() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.lineWidth = 2.4;
  ctx.strokeStyle = "#fa528e";
  ctx.lineCap = "round";
  for(let path of paths) {
    ctx.beginPath();
    for(let i=0; i<path.length; ++i) {
      if(i===0) ctx.moveTo(path[i].x, path[i].y);
      else ctx.lineTo(path[i].x, path[i].y);
    }
    ctx.stroke();
  }
}
function clearCanvas() { paths = []; redrawCanvas(); }
function undoDraw() { if(paths.length){ undone.push(paths.pop()); redrawCanvas(); } }
function downloadSignature() {
  let link = document.createElement('a');
  link.download = 'signature.png';
  link.href = canvas.toDataURL();
  link.click();
  // Optionally set as current watermark logo:
  signatureImage = canvas.toDataURL();
  watermarkLogo = signatureImage;
  watermarkLogoImage = new window.Image();
  watermarkLogoImage.onload = renderPreview;
  watermarkLogoImage.src = signatureImage;
}

// ============ PREVIEW & PLACEMENT LOGIC ============
const preview = document.getElementById('wm-preview');
const pctx = preview.getContext('2d');
function renderPreview() {
  pctx.clearRect(0,0,preview.width,preview.height);
  // BG (optional: show checkerboard or user’s sample img)
  pctx.fillStyle = "#2a2434";
  pctx.fillRect(0,0,preview.width,preview.height);
  // Draw watermark text
  if(watermarkText){
    pctx.save();
    pctx.translate(watermarkPosX, watermarkPosY);
    pctx.rotate(watermarkAngle * Math.PI/180);
    pctx.globalAlpha = watermarkAlpha;
    pctx.font = `${watermarkSize}px ${watermarkFont}`;
    pctx.fillStyle = watermarkColor;
    pctx.shadowColor = "#fa528e66";
    pctx.shadowBlur = 5;
    pctx.fillText(watermarkText, 0, 0);
    pctx.globalAlpha = 1;
    pctx.restore();
  }
  // Draw logo (if any)
  if(watermarkLogoImage){
    pctx.save();
    pctx.translate(watermarkPosX+80, watermarkPosY-30);
    pctx.globalAlpha = watermarkAlpha;
    pctx.drawImage(watermarkLogoImage, 0, 0, 90, 48);
    pctx.globalAlpha = 1;
    pctx.restore();
  }
}
renderPreview();

// ============ EXPORT & BATCH MODE =============
function downloadWatermark() {
  let link = document.createElement('a');
  link.download = 'watermark.png';
  link.href = preview.toDataURL();
  link.click();
}
function batchApply() {
  let files = document.getElementById('batch-upload').files;
  if(!files.length) return alert("Select images to batch apply watermark.");
  Array.from(files).forEach(f=>{
    let reader = new FileReader();
    reader.onload = function(evt){
      let img = new window.Image();
      img.onload = function(){
        let cv = document.createElement('canvas');
        cv.width = img.width;
        cv.height = img.height;
        let cctx = cv.getContext('2d');
        cctx.drawImage(img,0,0);
        // Add watermark text
        cctx.save();
        cctx.globalAlpha = watermarkAlpha;
        cctx.font = `${watermarkSize}px ${watermarkFont}`;
        cctx.fillStyle = watermarkColor;
        cctx.textBaseline = "bottom";
        cctx.shadowColor = "#fa528e55";
        cctx.shadowBlur = 4;
        let wx = Math.min(img.width-180, watermarkPosX);
        let wy = Math.max(40, img.height-30);
        cctx.translate(wx, wy);
        cctx.rotate(watermarkAngle * Math.PI/180);
        cctx.fillText(watermarkText, 0, 0);
        cctx.restore();
        // Add logo if any
        if(watermarkLogoImage){
          cctx.save();
          cctx.globalAlpha = watermarkAlpha;
          cctx.drawImage(watermarkLogoImage, wx+80, wy-30, 90, 48);
          cctx.restore();
        }
        let out = document.createElement('a');
        out.download = "watermarked_"+f.name;
        out.href = cv.toDataURL();
        out.click();
      };
      img.src = evt.target.result;
    };
    reader.readAsDataURL(f);
  });
}

// ========== SAVE/LOAD WATERMARK LOCALLY ==========
function saveWatermarkLocal() {
  let data = {
    text: watermarkText, font: watermarkFont, size: watermarkSize,
    color: watermarkColor, alpha: watermarkAlpha, angle: watermarkAngle,
    posX: watermarkPosX, posY: watermarkPosY,
    logo: watermarkLogo
  };
  localStorage.setItem("pf_watermark", JSON.stringify(data));
  alert("Watermark saved locally! Use 'Load Saved' next time.");
}
function loadWatermarkLocal() {
  let data = localStorage.getItem("pf_watermark");
  if(!data) return alert("No saved watermark found.");
  try {
    data = JSON.parse(data);
    watermarkText = data.text;
    watermarkFont = data.font;
    watermarkSize = data.size;
    watermarkColor = data.color;
    watermarkAlpha = data.alpha;
    watermarkAngle = data.angle;
    watermarkPosX = data.posX;
    watermarkPosY = data.posY;
    watermarkLogo = data.logo;
    if(watermarkLogo){
      watermarkLogoImage = new window.Image();
      watermarkLogoImage.onload = renderPreview;
      watermarkLogoImage.src = watermarkLogo;
    }
    updateAllInputs();
    renderPreview();
  } catch(e) {
    alert("Failed to load watermark!");
  }
}

// ============ INSPIRATION (AI) =============
const watermarkIdeas = [
  "Try your Instagram handle in a handwritten font.",
  "A diagonal stamp with your brand color—subtle but bold.",
  "Use your real signature (draw it!) for the most authentic mark.",
  "Layer your logo plus translucent text for pro vibes.",
  "Batch watermark 10+ photos at once and save hours.",
  "Try blending modes (lighten/multiply) for a unique look.",
  "Watermark only corners or rotate to match the image angle.",
  "Create a custom emoji or mascot as your watermark.",
  "Add the year or website for anti-theft.",
  "Preview at several sizes—small marks are less distracting."
];
function showInspiration() {
  const idea = watermarkIdeas[Math.floor(Math.random()*watermarkIdeas.length)];
  document.getElementById('wm-inspire').textContent = idea;
}

// ============ GALLERY SAMPLES =============
function fillGallery() {
  let gallery = document.getElementById('wm-gallery');
  let imgs = [
    "sample1.png", "sample2.png", "sample3.png", "sample4.png", "sample5.png"
  ];
  imgs.forEach(name=>{
    let img = document.createElement('img');
    img.src = "/assets/watermark_templates/"+name;
    img.className = "wm-gallery-img";
    img.alt = "Watermarked sample";
    gallery.appendChild(img);
  });
}
fillGallery();

// ============ J1NX MINI CHAT =============
function updateJ1nxMini(txt) {
  const bubble = document.getElementById('j1nx-mini-bubble');
  bubble.textContent = txt;
  bubble.scrollTop = bubble.scrollHeight;
}
function j1nxChat() {
  const val = document.getElementById('j1nx-mini-input').value.trim();
  if(!val) return;
  let reply = typeof getJ1nxWatermarkReply === "function"
    ? getJ1nxWatermarkReply(val)
    : "I'm here to help with anything watermark! (Try: fonts, export, custom logo, batch, signature...)";
  updateJ1nxMini(reply);
  document.getElementById('j1nx-mini-input').value = "";
}
document.getElementById('j1nx-mini-input').addEventListener('focus', function(){ updateJ1nxMini("Ask me about watermark tips, export, signatures, or anything!"); });
document.getElementById('j1nx-mini-input').addEventListener('keydown', function(e){
  if(e.key==="Enter"){ j1nxChat(); }
});

// ============ END OF PAGE ============
</script>
</body>
</html>
