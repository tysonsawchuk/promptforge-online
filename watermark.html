<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PromptForge.online | Watermark Studio</title>
  <meta name="description" content="Add custom watermarks to your images‚Äîtext, logos, shapes, batch mode. Protect your art with pro-level design.">
  <meta name="keywords" content="watermark, image protection, AI art, copyright, batch watermark, design, logo, PromptForge">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <meta property="og:title" content="PromptForge | Pro Watermark Studio">
  <meta property="og:description" content="Create and apply stunning watermarks‚Äîtext, logos, and more‚Äîon all your images. Free, advanced, and easy.">
  <meta property="og:image" content="/assets/promptforge-og-pic.png">
  <link rel="icon" type="image/png" href="/assets/favicon.png">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4963053724895140" crossorigin="anonymous"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&family=Fira+Mono:wght@400;700&display=swap');
    :root {
      --brand: #64f2e3;
      --brand2: #be9cff;
      --accent: #ffe266;
      --bg: #161c19;
      --panel: #242e26;
      --card: #20231f;
      --shadow: 0 4px 40px #1a1a1a80;
      --offwhite: #f4f6ef;
      --link: #6ee6ff;
      --danger: #fa527a;
      --footer-bg: #191b19;
      --menu-bg: #252628;
    }
    html,body{margin:0;padding:0;width:100vw;min-height:100vh;background:var(--bg);color:var(--offwhite);font-family:'Inter',sans-serif;font-size:1.13em;}
    .newsbar {
      width:100vw; min-height:46px;
      display:flex; align-items:center; justify-content:center;
      background:linear-gradient(90deg,var(--bg),var(--footer-bg),var(--bg));
      color:var(--brand2);font-weight:700;font-size:1.01em;
      border-bottom:1.5px solid var(--brand2);
      box-shadow:0 2px 10px #0004;
      letter-spacing:.01em;
      position:relative;z-index:20;
    }
    .newsbar .version {
      margin-right:1.3em;padding:.16em .7em;background:var(--brand2);color:#24231f;
      border-radius:8px;font-size:.97em;font-weight:700;vertical-align:middle;
    }
    .newsbar .ai-news {
      margin:0 1.1em;max-width:60vw;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }
    .nav {background:var(--panel);display:flex;align-items:center;justify-content:space-between;padding:.85em 0 1.1em 0;}
    .nav-l {display:flex;align-items:center;}
    .nav .logo {font-family:'Fira Mono',monospace;font-size:2.08em;font-weight:900;background:linear-gradient(90deg,var(--brand),var(--brand2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin:0 .5em;}
    .nav .breadcrumb {display:flex;gap:.95em;}
    .nav .breadcrumb a {color:var(--brand);text-decoration:none;font-weight:600;letter-spacing:.04em;transition:.15s;}
    .nav .breadcrumb a.active,.nav .breadcrumb a:focus {color:var(--accent);border-bottom:2.5px solid var(--accent);}
    .nav .breadcrumb a:hover {color:var(--accent);}
    .nav .socials {display:flex;gap:.85em;}
    .nav .socials a {display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;background:#2223;border-radius:7px;transition:.14s;}
    .nav .socials a:hover {background:var(--brand2);}
    .desc {max-width:820px;margin:0 auto 1.5em auto;text-align:center;color:var(--brand2);font-size:1.13em;}
    .adsense-block {background:var(--panel);border-radius:14px;box-shadow:0 2px 12px #1a1a1a20;margin:2.2em auto 1em auto;padding:1.5em 0 1em 0;max-width:700px;display:flex;align-items:center;justify-content:center;}
    .mainbox {max-width:1450px;margin:2.3em auto 2em auto;background:var(--panel);border-radius:18px;box-shadow:var(--shadow);padding:2.7em 2.5em 2.6em 2.5em;}
    .watermark-frame {display:flex;flex-wrap:wrap;gap:3em;justify-content:center;}
    .wm-preview-area {flex:2;min-width:330px;max-width:740px;display:flex;flex-direction:column;align-items:center;}
    .wm-upload-label {font-weight:900;font-size:1.1em;color:var(--brand2);}
    #wm-upload {display:none;}
    .wm-upload-box {
      background:var(--card);border:2.5px dashed var(--brand2);border-radius:17px;box-shadow:0 3px 16px #0005;
      min-height:220px;min-width:310px;max-width:520px;display:flex;flex-direction:column;align-items:center;justify-content:center;
      padding:2em 1.7em;margin-bottom:1.7em;cursor:pointer;transition:.18s;
    }
    .wm-upload-box:hover {background:var(--menu-bg);border-color:var(--brand);}
    .wm-preview-canvas {background:#232323;border-radius:12px;box-shadow:0 3px 18px #0004;margin-bottom:.9em;}
    .wm-filename {font-size:.97em;color:var(--brand2);margin-bottom:.3em;}
    .wm-designer-area {flex:1;min-width:320px;max-width:420px;}
    .wm-section-title {font-weight:900;color:var(--brand2);font-size:1.09em;margin:.7em 0 .7em .4em;}
    .microhelp {margin-left:.7em;color:var(--accent);font-size:1.12em;cursor:pointer;user-select:none;}
    .chips {margin:.2em 0 0 .7em;}
    @media (max-width:1000px){.watermark-frame{flex-direction:column;align-items:center;gap:2.5em;}}
    @media (max-width:600px){.mainbox{padding:.6em;}}
  </style>
</head>
<body>
  <div class="newsbar">
    <span class="version">v1.0.0</span>
    <span class="ai-news" id="ai-news-headline">Loading latest AI news...</span>
  </div>
  <nav class="nav">
    <div class="nav-l">
      <span class="logo">PromptForge</span>
      <span class="breadcrumb">
        <a href="main.html">Main</a>
        <a href="picture.html">Image</a>
        <a href="movie.html">Movie</a>
        <a href="watermark.html" class="active">Watermark</a>
        <a href="j1nx.html">J1nx</a>
        <a href="aihacks.html">AI Hacks</a>
        <a href="ansiart.html">AnsiArt</a>
        <a href="compare.html">Compare</a>
      </span>
    </div>
    <div class="socials">
      <a href="https://bsky.app/profile/goreandgiggles.bsky.social" target="_blank" title="Bluesky"><img src="/assets/bluesky.svg" alt="Bluesky" class="menu-icon"></a>
      <a href="https://x.com/GoreandGiggles" target="_blank" title="X"><img src="/assets/x-twitter.svg" alt="X" class="menu-icon"></a>
      <a href="https://www.buymeacoffee.com/goreandgiggles" target="_blank" title="Buy Me a Coffee"><img src="/assets/coffee.svg" alt="Coffee" class="menu-icon"></a>
    </div>
  </nav>
  <div class="desc">
    <b>Design & apply next-level watermarks‚Äîtext, logos, shapes, and more!</b>
    <span style="color:var(--accent);">Drag, style, batch, and protect all your images. True pro studio, no limits.</span>
  </div>
  <div class="adsense-block">
    <ins class="adsbygoogle"
      style="display:block;min-width:320px;min-height:60px;"
      data-ad-client="ca-pub-4963053724895140"
      data-ad-slot="5732117276"
      data-ad-format="auto"
      data-full-width-responsive="true"></ins>
    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
  </div>
  <div class="mainbox" id="watermark-studio">
    <div class="watermark-frame" id="watermark-frame">
      <!-- Left: Upload + Preview -->
      <div class="wm-preview-area">
        <label class="wm-upload-label" for="wm-upload">
          Upload or drop your image here
          <span class="microhelp" onclick="showHelp('upload')">?</span>
        </label>
        <div class="wm-upload-box" id="wm-upload-box" onclick="document.getElementById('wm-upload').click()" ondrop="handleDrop(event)" ondragover="event.preventDefault()">
          <input type="file" id="wm-upload" accept="image/*" style="display:none" onchange="handleImage(event)">
          <span id="wm-upload-desc" style="color:var(--offwhite);font-size:1.08em;">Click or drag an image</span>
        </div>
        <span class="wm-filename" id="wm-filename"></span>
        <canvas id="wm-canvas" class="wm-preview-canvas" width="512" height="512" style="max-width:100%;border:2px solid var(--brand2);"></canvas>
      </div>
      <!-- Right: Watermark Designer -->
      <div class="wm-designer-area">
        <div class="wm-section-title">Watermark Designer <span class="microhelp" onclick="showHelp('designer')">?</span></div>
        <!-- Block 2 (designer tools, text/logo, layers, styles, controls) goes here -->
      </div>
    </div>
    <!-- J1nx Dock (correct cutout, pro tips) -->
    <div id="j1nx-ui" style="position:fixed;bottom:32px;right:36px;z-index:99;max-width:370px;transition:opacity .18s,transform .22s;">
      <div class="j1nx-shell" style="position:relative;display:flex;align-items:flex-end;">
        <img class="j1nx-cutout" src="/assets/j1nx-cutout.png" alt="J1nx" style="width:126px;position:relative;z-index:3;">
        <div class="j1nx-bubble" id="j1nx-bubble"
          style="background:#201733;border:2.5px solid var(--brand2);border-radius:18px 18px 24px 18px/18px 18px 42px 18px;box-shadow:0 4px 22px #be9cff45;padding:1.15em 1.1em .8em 1.19em;min-height:108px;min-width:220px;max-width:265px;position:relative;z-index:4;margin-bottom:14px;color:var(--offwhite);font-size:1.09em;">
          <span class="j1nx-name" style="font-weight:900;color:var(--brand2);font-size:1.07em;">J1nx</span>
          <span class="j1nx-mood" id="j1nx-mood">üõ°Ô∏è</span>
          <span class="j1nx-min" title="Minimize J1nx" onclick="toggleJ1nxMin()" style="position:absolute;top:6px;right:10px;background:#4442;padding:.13em .55em;border-radius:8px;color:var(--brand2);font-weight:900;cursor:pointer;">‚Äì</span>
          <div id="j1nx-speech" style="margin:.65em 0 .6em 0;">Ready to protect your art? I can help with watermark design tips.</div>
          <input id="j1nx-input" type="text" placeholder="Ask J1nx anything..." style="width:81%;margin-right:.5em;padding:.54em .8em;border-radius:7px;border:1.7px solid var(--brand2);background:#211e32;color:var(--offwhite);font-size:1.07em;">
          <div style="margin-top:.5em;">
            <button class="j1nx-btn" onclick="sendJ1nx()" style="background:var(--brand2);color:#23231f;border:none;border-radius:7px;padding:.35em 1.18em;font-weight:bold;cursor:pointer;margin-right:.7em;">Send</button>
            <button class="j1nx-btn" onclick="j1nxRandomTip()" style="background:var(--brand2);color:#23231f;border:none;border-radius:7px;padding:.35em 1.18em;font-weight:bold;cursor:pointer;">WM Tip</button>
            <button class="j1nx-btn" title="Secret Mode" id="j1nx-easter" style="background:#b5ffb7;color:#23231f;border:none;border-radius:7px;padding:.35em 1.18em;font-weight:bold;cursor:pointer;">‚òÖ</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Block 2: full watermark designer controls, styling, shapes, batch, export, all logic -->
        <!-- TEXT WATERMARK DESIGN -->
        <div class="wm-section-title">Text Watermark <span class="microhelp" onclick="showHelp('wmtext')">?</span></div>
        <input id="wm-text" type="text" maxlength="64" placeholder="Enter watermark text (e.g. @PromptForge, Copyright, etc)" style="width:95%;margin:.6em 0 1.2em 0;padding:.8em 1.1em;font-size:1.13em;border-radius:9px;border:1.8px solid var(--brand2);background:var(--card);color:var(--offwhite);">
        <div style="display:flex;flex-wrap:wrap;gap:1.4em;margin-bottom:.9em;">
          <div>
            <label style="font-weight:700;">Font
              <select id="wm-font" style="margin-left:.5em;border-radius:8px;background:var(--card);color:var(--offwhite);">
                <option value="Montserrat">Montserrat</option>
                <option value="Roboto Slab">Roboto Slab</option>
                <option value="Lato">Lato</option>
                <option value="Oswald">Oswald</option>
                <option value="Inter">Inter</option>
                <option value="Arial">Arial</option>
                <option value="Georgia">Georgia</option>
                <option value="Courier New">Courier New</option>
                <option value="Comic Sans MS">Comic Sans</option>
                <option value="Impact">Impact</option>
              </select>
            </label>
          </div>
          <div>
            <label style="font-weight:700;">Size
              <input id="wm-fontsize" type="range" min="16" max="128" value="32" style="margin-left:.7em;vertical-align:middle;">
              <span id="wm-fontsize-val" style="margin-left:.3em;font-weight:700;color:var(--brand2);">32</span>
            </label>
          </div>
          <div>
            <label style="font-weight:700;">Color
              <input id="wm-color" type="color" value="#ffffff" style="margin-left:.5em;border-radius:6px;">
            </label>
          </div>
          <div>
            <label style="font-weight:700;">Opacity
              <input id="wm-opacity" type="range" min="10" max="100" value="42" style="margin-left:.5em;vertical-align:middle;">
              <span id="wm-opacity-val" style="margin-left:.3em;font-weight:700;color:var(--brand2);">42</span>
            </label>
          </div>
        </div>
        <div style="display:flex;gap:1.3em;margin-bottom:1em;">
          <label><input type="checkbox" id="wm-bold"> Bold</label>
          <label><input type="checkbox" id="wm-italic"> Italic</label>
          <label><input type="checkbox" id="wm-shadow"> Shadow</label>
          <label><input type="checkbox" id="wm-outline"> Outline</label>
        </div>

        <!-- LOGO / IMAGE WATERMARK -->
        <div class="wm-section-title">Logo/Image Watermark <span class="microhelp" onclick="showHelp('wmlogo')">?</span></div>
        <div style="display:flex;align-items:center;gap:1.2em;">
          <input type="file" id="wm-logo-upload" accept="image/*,image/svg+xml" onchange="handleLogo(event)">
          <button type="button" onclick="removeLogo()" style="border-radius:6px;background:var(--danger);color:#fff;padding:.3em 1em;margin-left:.7em;">Remove</button>
        </div>
        <div id="wm-logo-preview" style="margin:1em 0 1.4em 0;"></div>
        <div style="display:flex;flex-wrap:wrap;gap:1.4em;margin-bottom:.9em;">
          <div>
            <label style="font-weight:700;">Logo Size
              <input id="wm-logosize" type="range" min="32" max="350" value="96" style="margin-left:.7em;vertical-align:middle;">
              <span id="wm-logosize-val" style="margin-left:.3em;font-weight:700;color:var(--brand2);">96</span>
            </label>
          </div>
          <div>
            <label style="font-weight:700;">Logo Opacity
              <input id="wm-logo-opacity" type="range" min="10" max="100" value="35" style="margin-left:.5em;vertical-align:middle;">
              <span id="wm-logo-opacity-val" style="margin-left:.3em;font-weight:700;color:var(--brand2);">35</span>
            </label>
          </div>
          <div>
            <label style="font-weight:700;">Rotate
              <input id="wm-logo-rotate" type="range" min="0" max="360" value="0" style="margin-left:.5em;vertical-align:middle;">
              <span id="wm-logo-rotate-val" style="margin-left:.3em;font-weight:700;color:var(--brand2);">0¬∞</span>
            </label>
          </div>
        </div>

        <!-- SHAPES / BANNERS -->
        <div class="wm-section-title">Shape / Banner Overlay <span class="microhelp" onclick="showHelp('wmshape')">?</span></div>
        <div style="display:flex;gap:1.3em;margin-bottom:.8em;">
          <button type="button" onclick="addShape('rect')" style="border-radius:7px;background:#4df6a0;color:#23231f;padding:.43em 1.2em;">Rectangle</button>
          <button type="button" onclick="addShape('ellipse')" style="border-radius:7px;background:#64f2e3;color:#23231f;padding:.43em 1.2em;">Ellipse</button>
          <button type="button" onclick="addShape('banner')" style="border-radius:7px;background:#be9cff;color:#23231f;padding:.43em 1.2em;">Banner</button>
          <button type="button" onclick="addShape('line')" style="border-radius:7px;background:#ffe266;color:#23231f;padding:.43em 1.2em;">Line</button>
        </div>
        <div style="margin-bottom:1.3em;">
          <label style="font-weight:700;">Shape Color <input type="color" id="wm-shape-color" value="#ff2266" style="margin-left:.8em;border-radius:6px;"></label>
        </div>
        <div class="chips" id="wm-shapes-chips"></div>

        <!-- POSITION, TILE, BATCH, EXPORT -->
        <div class="wm-section-title">Watermark Placement & Export <span class="microhelp" onclick="showHelp('wmpos')">?</span></div>
        <div style="display:flex;flex-wrap:wrap;gap:1.3em;margin-bottom:.8em;">
          <label>Position
            <select id="wm-pos" style="margin-left:.7em;border-radius:7px;background:var(--card);color:var(--offwhite);">
              <option>Bottom Right</option>
              <option>Bottom Left</option>
              <option>Top Right</option>
              <option>Top Left</option>
              <option>Center</option>
              <option>Custom (drag)</option>
              <option>Tile/Repeat</option>
            </select>
          </label>
          <label>Margin <input id="wm-margin" type="range" min="0" max="120" value="24" style="margin-left:.6em;vertical-align:middle;"><span id="wm-margin-val" style="margin-left:.3em;font-weight:700;color:var(--brand2);">24</span></label>
          <label>Angle <input id="wm-angle" type="range" min="0" max="360" value="0" style="margin-left:.6em;vertical-align:middle;"><span id="wm-angle-val" style="margin-left:.3em;font-weight:700;color:var(--brand2);">0¬∞</span></label>
        </div>
        <div style="display:flex;gap:1.2em;margin-bottom:1.2em;">
          <label><input type="checkbox" id="wm-tile"> Tile watermark</label>
          <label><input type="checkbox" id="wm-show"> Show watermark</label>
        </div>
        <div style="margin-bottom:1.7em;">
          <button type="button" onclick="resetDesigner()" style="background:var(--danger);color:#fff;font-weight:bold;padding:.53em 2em;border-radius:9px;margin-right:.7em;">Reset</button>
          <button type="button" onclick="previewWatermark()" style="background:var(--brand2);color:#23231f;font-weight:bold;padding:.53em 2em;border-radius:9px;">Preview</button>
        </div>
        <div class="wm-section-title">Batch & Export <span class="microhelp" onclick="showHelp('wmbatch')">?</span></div>
        <div style="margin-bottom:1.2em;">
          <label><input type="checkbox" id="wm-batch"> Batch mode (apply to all images)</label>
        </div>
        <div style="display:flex;flex-wrap:wrap;gap:1.2em;">
          <button type="button" onclick="exportImage('png')" style="background:var(--accent);color:#23231f;font-weight:bold;padding:.53em 2em;border-radius:9px;">Download PNG</button>
          <button type="button" onclick="exportImage('jpg')" style="background:var(--brand);color:#23231f;font-weight:bold;padding:.53em 2em;border-radius:9px;">Download JPG</button>
          <button type="button" onclick="exportImage('webp')" style="background:var(--brand2);color:#23231f;font-weight:bold;padding:.53em 2em;border-radius:9px;">Download WebP</button>
          <button type="button" onclick="copyToClipboard()" style="background:#2223;color:var(--brand2);font-weight:bold;padding:.53em 2em;border-radius:9px;">Copy to Clipboard</button>
        </div>
    </div><!-- END wm-designer-area -->
  </div><!-- END mainbox -->

  <!-- FOOTER, CAMO, NAV, SOCIALS -->
  <footer style="background:var(--footer-bg);padding:2.5em 0 1.6em 0;margin-top:4em;position:relative;">
    <div class="footer-center">
      <pre class="footer-art" style="text-align:center;font-family:'Fira Mono',monospace;font-size:1.02em;color:var(--brand2);">
  ____      ____    U  ___ u  __  __    ____    _____    _____   U  ___ u   ____      ____  U _____ u   
U|  _"\\ uU |  _"\\ u  \\/"_ \\/U|\' \\/ \'|uU|  _"\\ u|_ " _|  |" ___|   \\/"_ \\/U |  _"\\ uU /"___|u\\| ___"|/   
\\| |_) |/ \\| |_) |/  | | | |\\| |\\/| |/\\| |_) |/  | |   U| |_  u   | | | | \\| |_) |/\\| |  _ / |  _|"     
 |  __/    |  _ <.-,_| |_| | | |  | |  |  __/   /| |\\  \\|  _|/.-,_| |_| |  |  _ <   | |_| |  | |___     
 |_|       |_| \\_\\\\_)-\\___/  |_|  |_|  |_|     u |_|U   |_|    \\_)-\\___/   |_| \\_\\   \\____|  |_____|    
      </pre>
    </div>
    <pre class="footer-camo" id="footerCamo" style="text-align:center;font-size:1.5em;"></pre>
    <div class="footer-row" style="max-width:1160px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;padding-top:1.1em;border-top:2px solid var(--brand2);font-size:1.04em;">
      <div class="footer-nav" style="display:flex;gap:1.15em;">
        <a href="main.html">Main</a>
        <a href="picture.html">Image</a>
        <a href="movie.html">Movie</a>
        <a href="watermark.html" class="active">Watermark</a>
        <a href="j1nx.html">J1nx</a>
        <a href="aihacks.html">AI Hacks</a>
        <a href="ansiart.html">AnsiArt</a>
        <a href="compare.html">Compare</a>
      </div>
      <div class="footer-socials" style="display:flex;gap:1em;">
        <a href="https://bsky.app/profile/goreandgiggles.bsky.social" target="_blank" title="Bluesky"><img src="/assets/bluesky.svg" alt="Bluesky" class="menu-icon"></a>
        <a href="https://x.com/GoreandGiggles" target="_blank" title="X"><img src="/assets/x-twitter.svg" alt="X" class="menu-icon"></a>
        <a href="https://www.buymeacoffee.com/goreandgiggles" target="_blank" title="Buy Me a Coffee"><img src="/assets/coffee.svg" alt="Coffee" class="menu-icon"></a>
      </div>
    </div>
  </footer>
  <script>
    // ========== GOOGLE AI NEWS BAR ==========
    async function fetchGoogleAINews() {
      try {
        const res = await fetch('https://api.rss2json.com/v1/api.json?rss_url=https://ai.googleblog.com/feeds/posts/default');
        const json = await res.json();
        const items = json.items || [];
        let i = 0;
        function updateHeadline() {
          if (items.length === 0) return;
          const item = items[i % items.length];
          document.getElementById('ai-news-headline').innerHTML = `<a href="${item.link}" target="_blank">${item.title}</a>`;
          i++;
        }
        updateHeadline();
        setInterval(updateHeadline, 9000);
      } catch(e) {
        document.getElementById('ai-news-headline').textContent = "Latest: Google AI Blog ‚Äì auto-update failed (offline)";
      }
    }
    fetchGoogleAINews();
    // ========== FOOTER CAMO ==========
    const camoColors = ["#64f2e3", "#23d7ba", "#4df6a0", "#bdf6c3", "#abffe6", "#abb8b8"];
    function randomCamoChar(){ const chars = "‚ñë‚ñí‚ñì‚ñö‚ñû‚ñê‚ñâ‚ñà‚ñõ"; return chars[Math.floor(Math.random()*chars.length)]; }
    function renderCamo(tick=0){ let out=""; for(let row=0;row<1;++row){ for(let col=0;col<62;++col){ let color=camoColors[(row+col+tick)%camoColors.length]; out+=`<span style="color:${color}">${randomCamoChar()}</span>`;} out+="<br>";} document.getElementById("footerCamo").innerHTML=out; }
    let camoTick = 0; setInterval(()=>{ renderCamo(camoTick++); },950); renderCamo();

    // ========== WATERMARK DESIGNER LOGIC ==========
    // (Handles text/logo/shapes, placement, preview, export, batch, and UI updates)
    // This is a basic functional JS block; expand further as needed!

    // Image upload and preview
    let baseImg = null, wmLogo = null, shapes = [];
    const canvas = document.getElementById('wm-canvas');
    const ctx = canvas.getContext('2d');
    function handleImage(event){
      const file = event.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = function(e){
        const img = new Image();
        img.onload = function(){
          baseImg = img;
          canvas.width = img.width;
          canvas.height = img.height;
          drawAll();
          document.getElementById('wm-filename').innerText = file.name;
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }
    function handleDrop(e){
      e.preventDefault();
      document.getElementById('wm-upload').files = e.dataTransfer.files;
      handleImage({target:{files:e.dataTransfer.files}});
    }

    // Logo watermark upload/preview
    function handleLogo(event){
      const file = event.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = function(e){
        const img = new Image();
        img.onload = function(){
          wmLogo = img;
          document.getElementById('wm-logo-preview').innerHTML = `<img src="${e.target.result}" alt="Logo Preview" style="max-width:64px;max-height:64px;">`;
          drawAll();
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }
    function removeLogo(){
      wmLogo = null;
      document.getElementById('wm-logo-preview').innerHTML = "";
      drawAll();
    }

    // Shape add/remove (rect, ellipse, banner, line)
    function addShape(type){
      const color = document.getElementById('wm-shape-color').value;
      shapes.push({type, color, x:60, y:60, w:120, h:40});
      updateShapesChips();
      drawAll();
    }
    function updateShapesChips(){
      document.getElementById('wm-shapes-chips').innerHTML = shapes.map((s,i)=>
        `<span style="background:${s.color};color:#222;padding:.2em .8em;border-radius:7px;margin-right:.4em;">${s.type}<span onclick="removeShape(${i})" style="color:#f44;font-weight:900;cursor:pointer;margin-left:.5em;">√ó</span></span>`
      ).join('');
    }
    function removeShape(idx){
      shapes.splice(idx,1); updateShapesChips(); drawAll();
    }

    // Designer value bindings
    function updateDesignerVals(){
      document.getElementById('wm-fontsize-val').innerText = document.getElementById('wm-fontsize').value;
      document.getElementById('wm-opacity-val').innerText = document.getElementById('wm-opacity').value;
      document.getElementById('wm-logosize-val').innerText = document.getElementById('wm-logosize').value;
      document.getElementById('wm-logo-opacity-val').innerText = document.getElementById('wm-logo-opacity').value;
      document.getElementById('wm-logo-rotate-val').innerText = document.getElementById('wm-logo-rotate').value+'¬∞';
      document.getElementById('wm-margin-val').innerText = document.getElementById('wm-margin').value;
      document.getElementById('wm-angle-val').innerText = document.getElementById('wm-angle').value+'¬∞';
    }
    ['wm-fontsize','wm-opacity','wm-logosize','wm-logo-opacity','wm-logo-rotate','wm-margin','wm-angle']
      .forEach(id=>document.getElementById(id).oninput=updateDesignerVals);

    // Draw watermark preview (basic version‚Äîexpand as needed!)
    function drawAll(){
      if(!baseImg) { ctx.clearRect(0,0,canvas.width,canvas.height); return; }
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.drawImage(baseImg,0,0,canvas.width,canvas.height);
      // Draw shapes (rect, ellipse, etc)
      shapes.forEach(s=>{
        ctx.save();
        ctx.fillStyle=s.color;
        if(s.type==='rect') ctx.fillRect(s.x,s.y,s.w,s.h);
        if(s.type==='ellipse'){
          ctx.beginPath();ctx.ellipse(s.x+s.w/2,s.y+s.h/2,s.w/2,s.h/2,0,0,2*Math.PI);
          ctx.fill();
        }
        if(s.type==='banner'){
          ctx.fillRect(s.x,s.y,s.w,s.h);
        }
        if(s.type==='line'){
          ctx.beginPath();ctx.moveTo(s.x,s.y);ctx.lineTo(s.x+s.w,s.y+s.h);ctx.strokeStyle=s.color;ctx.lineWidth=4;ctx.stroke();
        }
        ctx.restore();
      });
      // Draw logo
      if(wmLogo){
        let lsize = +document.getElementById('wm-logosize').value;
        let logoOpacity = +document.getElementById('wm-logo-opacity').value/100;
        let rotate = +document.getElementById('wm-logo-rotate').value;
        ctx.save();
        ctx.globalAlpha = logoOpacity;
        ctx.translate(canvas.width/2,canvas.height/2);
        ctx.rotate(rotate*Math.PI/180);
        ctx.drawImage(wmLogo,-lsize/2,-lsize/2,lsize,lsize);
        ctx.restore();
      }
      // Draw text
      const txt = document.getElementById('wm-text').value;
      if(txt){
        let size = +document.getElementById('wm-fontsize').value;
        let color = document.getElementById('wm-color').value;
        let font = document.getElementById('wm-font').value;
        let opacity = +document.getElementById('wm-opacity').value/100;
        ctx.save();
        ctx.globalAlpha = opacity;
        ctx.font = `${document.getElementById('wm-bold').checked?'bold ':''}${document.getElementById('wm-italic').checked?'italic ':''}${size}px '${font}',sans-serif`;
        ctx.fillStyle = color;
        // Position logic (basic: center, todo: support other pos/tile)
        ctx.textAlign = "center"; ctx.textBaseline = "middle";
        ctx.fillText(txt,canvas.width/2,canvas.height/2);
        if(document.getElementById('wm-shadow').checked){
          ctx.shadowColor = "#0008"; ctx.shadowBlur = 7;
          ctx.fillText(txt,canvas.width/2,canvas.height/2);
        }
        if(document.getElementById('wm-outline').checked){
          ctx.lineWidth = 2.7; ctx.strokeStyle = "#222";
          ctx.strokeText(txt,canvas.width/2,canvas.height/2);
        }
        ctx.restore();
      }
    }
    // Live update on designer controls
    ['wm-text','wm-font','wm-fontsize','wm-color','wm-opacity','wm-bold','wm-italic','wm-shadow','wm-outline',
     'wm-logosize','wm-logo-opacity','wm-logo-rotate'].forEach(id=>{
      document.getElementById(id).oninput=drawAll; if(document.getElementById(id).type==='checkbox') document.getElementById(id).onclick=drawAll;
    });
    document.getElementById('wm-pos').onchange=drawAll;
    document.getElementById('wm-margin').oninput=drawAll;
    document.getElementById('wm-angle').oninput=drawAll;
    document.getElementById('wm-tile').onchange=drawAll;
    document.getElementById('wm-show').onchange=drawAll;

    // Preview/Reset
    function previewWatermark(){ drawAll(); }
    function resetDesigner(){
      document.getElementById('wm-text').value="";
      document.getElementById('wm-fontsize').value=32;
      document.getElementById('wm-color').value="#ffffff";
      document.getElementById('wm-font').value="Montserrat";
      document.getElementById('wm-opacity').value=42;
      document.getElementById('wm-bold').checked=false;
      document.getElementById('wm-italic').checked=false;
      document.getElementById('wm-shadow').checked=false;
      document.getElementById('wm-outline').checked=false;
      removeLogo();
      shapes=[]; updateShapesChips();
      drawAll();
    }

    // Export/Download/Clipboard
    function exportImage(type){
      if(!baseImg) return;
      let mime = "image/png";
      if(type==="jpg") mime = "image/jpeg";
      if(type==="webp") mime = "image/webp";
      const url = canvas.toDataURL(mime);
      const a = document.createElement('a');
      a.href = url;
      a.download = "watermarked."+type;
      a.click();
    }
    function copyToClipboard(){
      canvas.toBlob(function(blob){
        const item = new ClipboardItem({'image/png': blob});
        navigator.clipboard.write([item]);
      });
    }

    // ========== MICROHELP POPOVERS ==========
    function showHelp(topic) {
      const helpText = {
        upload: "Upload your original image (PNG, JPG, WebP, GIF). High-res is best for watermarking.",
        designer: "Use these tools to add, style, and position text, logo, or shapes. All changes show live on your preview.",
        wmtext: "Enter your watermark text. Choose font, size, color, opacity. Use bold, italic, shadow, outline for style.",
        wmlogo: "Upload a logo or image (SVG, PNG, etc) as your watermark. Adjust size, opacity, and rotation.",
        wmshape: "Add rectangle, ellipse, line, or banner overlays. Choose color and size, drag to reposition.",
        wmpos: "Choose preset positions (corners, center) or drag your watermark. Tile/repeat for extra security.",
        wmbatch: "Batch mode: watermark multiple images at once. All settings will apply to every image.",
      };
      let box = document.createElement("div");
      box.className = "microhelp-popover";
      box.style = "position:fixed;z-index:999;background:var(--card);color:var(--offwhite);border-radius:8px;box-shadow:0 2px 12px #000a;padding:1.1em 1.6em;max-width:340px;top:18%;left:50%;transform:translateX(-50%);font-size:1.08em;font-weight:600;text-align:left;";
      box.innerHTML = `<span style="color:var(--brand2);font-size:1.12em;font-weight:900;">Help</span><br>${helpText[topic]||'Ask J1nx for extra help!'}<br><br><button onclick="this.parentElement.remove()" style="margin-top:.7em;background:var(--brand2);color:#23231f;font-weight:bold;padding:.5em 1.25em;border-radius:8px;border:none;cursor:pointer;">Close</button>`;
      document.body.appendChild(box);
    }

    // ========== J1NX WATERMARK DOCK ==========
    // (Use same pro J1nx logic as picture/movie‚Äîcustom tips for watermarking)
    let j1nxState = { mood: "üõ°Ô∏è", clickCount: 0, minimized: false };
    const j1nxTips = [
      "Use a semi-transparent watermark for best balance of protection and style.",
      "Combine text and logo for maximum branding.",
      "Tile or repeat watermark for images you want shared but not stolen.",
      "Add a rectangle or banner for high-visibility watermarking.",
      "Export as PNG for best quality and transparency.",
      "Batch watermark multiple images to save time.",
      "Hide watermark when previewing original, then toggle it back on.",
      "Be sure your watermark doesn't cover faces or main subjects.",
      "Ask me how to legally protect your art!"
    ];
    function setJ1nxMood(idx,msgOverride){
      document.getElementById("j1nx-mood").innerText = j1nxTips[idx%j1nxTips.length].charAt(0) || "üõ°Ô∏è";
      document.getElementById("j1nx-speech").innerText = msgOverride||j1nxTips[idx%j1nxTips.length];
    }
    function sendJ1nx() {
      const input = document.getElementById("j1nx-input").value.trim().toLowerCase();
      let out = "Need tips on placement, batch, or logo use?";
      if(!input) { setJ1nxMood(0); return; }
      if(input.includes("random")||input.includes("tip")) out = j1nxTips[Math.floor(Math.random()*j1nxTips.length)];
      if(input.includes("protect")||input.includes("secure")||input.includes("legal")){
        out = "Legally, watermarking helps, but always register your best work for full protection!";
      }
      setJ1nxMood(Math.floor(Math.random()*j1nxTips.length), out);
      document.getElementById("j1nx-input").value = "";
    }
    function j1nxRandomTip(){ setJ1nxMood(Math.floor(Math.random()*j1nxTips.length)); }
    function toggleJ1nxMin(){
      j1nxState.minimized = !j1nxState.minimized;
      document.getElementById("j1nx-ui").classList.toggle("minimized",j1nxState.minimized);
      if(!j1nxState.minimized) setJ1nxMood(0);
    }
  </script>
</body>
</html>
